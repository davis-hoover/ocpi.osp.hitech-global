<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenCPI zrf8_48dr Developers Guide &mdash; OpenCPI assets</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/ocpidocument-style.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/test_result.css, css/ocpidocument-style.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="prev" title="OpenCPI zrf8_48dr Getting Started Guide" href="OpenCPI_zrf8_48dr_Getting_Started_Guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html">
            <img src="../../../../_static/logo_ocpi.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                OpenCPI Release: develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">zrf8_48dr General Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="OpenCPI_zrf8_48dr_Getting_Started_Guide.html">OpenCPI zrf8_48dr Getting Started Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OpenCPI zrf8_48dr Developers Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#deliverables">Deliverables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preview-of-the-concluding-directory-tree">Preview of the concluding directory tree</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#design-staging">Design Staging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#take-inventory-of-the-target-board">Take inventory of the target board</a></li>
<li class="toctree-l4"><a class="reference internal" href="#review-vendor-s-reference-design-package">Review Vendor’s Reference Design Package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#opencpi-staging">OpenCPI Staging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-the-opencpi-framework">Install the OpenCPI framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-a-host-terminal-for-opencpi-development">Configure a host terminal for OpenCPI development</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifications-to-the-install-and-deploy-scripts">Modifications to the Install and Deploy scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-the-software-cross-compiler">Setup the Software cross-compiler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-and-deployment">Install and Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#benchmark-testing-the-opencpi-zcu104-osp">Benchmark testing the OpenCPI zcu104 OSP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-an-opencpi-project-for-the-zrf8">Create an OpenCPI project for the ZRF8</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#enable-opencpi-hdl-control-plane">Enable OpenCPI HDL Control Plane</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-ps-for-cp">Configure PS for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-hdl-primitive-for-cp">Create HDL Primitive for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-hdl-primitive-for-cp">Build HDL Primitive for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-hdl-platform-worker-for-cp">Create HDL Platform Worker for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-hdl-platform-worker-for-cp">Build HDL Platform Worker for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-hdl-platform-zrf8-48dr-for-cp">Install the HDL Platform zrf8_48dr for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#petalinux-workspace-for-cp">Petalinux workspace for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-cp-boot-artifacts">Create CP Boot Artifacts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-rcc-platform-xilinx21-1-aarch64-for-cp">Install the RCC Platform xilinx21_1_aarch64 for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploy-the-platforms-for-cp">Deploy the Platforms for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#populate-the-sd-card-artifacts-for-cp">Populate the SD-Card Artifacts for CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hdl-cp-verification-opencpi-magic-word">HDL CP Verification: OpenCPI Magic Word</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hdl-cp-verification-pattern-capture-application">HDL CP Verification: Pattern Capture application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#enable-opencpi-hdl-data-plane">Enable OpenCPI HDL Data Plane</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-ps-for-dp">Configure PS for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-hdl-primitive-for-dp">Configure HDL Primitive for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-hdl-primitive-for-dp">Build HDL Primitive for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-hdl-platform-worker-for-dp">Configure HDL Platform Worker for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-hdl-platform-worker-for-dp">Build HDL Platform Worker for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#undo-edits-made-to-validate-hdl-cp">Undo edits made to validate HDL CP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-hdl-platform-zrf8-48dr-for-dp">Install the HDL Platform zrf8_48dr for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#petalinux-workspace-for-dp">Petalinux workspace for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-dp-boot-artifacts">Create DP Boot Artifacts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-rcc-platform-xilinx21-1-aarch64-for-dp">Install the RCC Platform xilinx21_1_aarch64 for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deploy-the-platforms-for-dp">Deploy the Platforms for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#populate-the-sd-card-artifacts-for-dp">Populate the SD-Card Artifacts for DP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hdl-dp-verification-testbias-application">HDL DP Verification: testbias application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#component-unit-testing">Component Unit Testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-the-unit-tests-in-parallel-on-the-development-host">Build the Unit Tests (in parallel) on the Development Host</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-unit-tests-sequentially-on-the-development-host">Run the Unit Tests (Sequentially) on the Development Host</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#appendix">APPENDIX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#petalinux-fix-for-zrf8">Petalinux Fix for ZRF8</a></li>
<li class="toctree-l4"><a class="reference internal" href="#format-sd-card">Format SD card</a></li>
<li class="toctree-l4"><a class="reference internal" href="#booting-the-zrf8-48dr">Booting the zrf8_48dr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standalone-mode-setup">Standalone Mode setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-mode-setup">Server Mode setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-results-tables">Test results tables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">OpenCPI assets</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">zrf8_48dr General Documentation</a></li>
      <li class="breadcrumb-item active">OpenCPI zrf8_48dr Developers Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="opencpi-zrf8-48dr-developers-guide">
<span id="dev-opencpi-zrf8-48dr-developers-guide"></span><h1>OpenCPI zrf8_48dr Developers Guide</h1>
<section id="introduction">
<span id="dev-introduction"></span><h2>Introduction</h2>
<p>The OSP supports the following minimum requirement:</p>
<ol class="arabic simple">
<li><p>Control Plane via a single Master AXI High-Performance Memory Mapped port of the RFSoC</p></li>
<li><p>Data Plane via four Slave Streaming-AXI High-Performance ports of the RFSoC</p></li>
<li><p>Platform Configurations: <code class="docutils literal notranslate"><span class="pre">base</span></code></p></li>
<li><p>Several device/proxy workers to interface with devices that are external to the UltraScale+ RFSoC</p></li>
<li><p>Benchmarking:</p>
<ol class="arabic simple">
<li><p>Control Plane (CP) ONLY verification on the zcu104</p>
<ul class="simple">
<li><p>CP reference application, i.e. <code class="docutils literal notranslate"><span class="pre">pattern_capture</span></code></p></li>
</ul>
</li>
<li><p>Data Plane (DP) verification of the following on the zcu104</p>
<ul class="simple">
<li><p>DP reference application, i.e. <code class="docutils literal notranslate"><span class="pre">testbias</span></code></p></li>
</ul>
</li>
</ol>
</li>
</ol>
<section id="deliverables">
<span id="dev-deliverables"></span><h3>Deliverables</h3>
<ol class="arabic simple">
<li><p>An OpenCPI project named, <code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global</span></code></p></li>
<li><p>One OpenCPI Board Support Package (OSP)</p>
<ul class="simple">
<li><p>HDL Platform named <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code>, with an RCC platform dependency on <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code></p></li>
</ul>
</li>
<li><p>Support of the HDL Control Plane, HDL Data Plane, and interfaces to various other devices in a manner that is comparable with the vendor provided SDR</p></li>
<li><p>Documentation</p>
<ul class="simple">
<li><p>OpenCPI zrf8_48dr Getting Started Guide</p></li>
<li><p>OpenCPI zrf8_48dr Developers Guide (This Guide)</p></li>
</ul>
</li>
</ol>
</section>
<section id="prerequisites">
<span id="dev-prerequisites"></span><h3>Prerequisites</h3>
<ol class="arabic simple">
<li><p><strong>Knowledge</strong></p>
<ol class="arabic simple">
<li><p>A working knowledge of the OpenCPI framework is a must. Its documentation is located at <a class="reference external" href="https://opencpi.gitlab.io/releases/">https://opencpi.gitlab.io/releases/</a>. Close attention must be made to the following:</p>
<ul class="simple">
<li><p>OpenCPI Platform Development Guide</p></li>
<li><p>OpenCPI Component Development Guide</p></li>
<li><p>Getting Started Guide for the ZCU104</p></li>
</ul>
</li>
<li><p>High-Tech Global ZRF8 Documentation - <strong>The following documentation must be requested directly from Hitech Global</strong></p>
<ul class="simple">
<li><p>HiTech-Global ZRF8 Users Guide</p></li>
<li><p>HiTech-Global ZRF8 Schematic</p></li>
</ul>
</li>
</ol>
</li>
<li><p><strong>Tools</strong></p>
<ol class="arabic simple">
<li><p>Xilinx tools:</p>
<ul class="simple">
<li><p>Vivado/SDK 2021.1</p></li>
<li><p>Petalinux: v2021.1</p></li>
</ul>
</li>
<li><p>OpenCPI FOSS framework, <a class="reference external" href="https://gitlab.com/opencpi/opencpi.git">https://gitlab.com/opencpi/opencpi.git</a></p></li>
</ol>
</li>
</ol>
</section>
<section id="preview-of-the-concluding-directory-tree">
<span id="dev-preview-of-the-concluding-directory-tree"></span><h3>Preview of the concluding directory tree</h3>
<p>This guide requires the creation of many directories. A summary of those directories are provided below:</p>
<p><strong>Clone of OpenCPI FOSS framework</strong>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>OpenCPI project repo directory for ZRF8</strong>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">osps</span><span class="o">/</span><span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Vendor’s reference design(s)</strong>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">reference_design</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">zrf8_48dr_cp</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">zrf8_48dr_dp</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Petalinux directories</strong>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">zrf8_48dr_cp</span><span class="o">/</span><span class="n">pl_core</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">htg</span><span class="o">-</span><span class="n">zrf8</span><span class="o">-</span><span class="n">rev3</span><span class="o">/</span><span class="n">pl_core</span><span class="o">/</span><span class="n">petalinux_cp</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">zrf8_48dr_dp</span><span class="o">/</span><span class="n">pl_core</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">htg</span><span class="o">-</span><span class="n">zrf8</span><span class="o">-</span><span class="n">rev3</span><span class="o">/</span><span class="n">pl_core</span><span class="o">/</span><span class="n">petalinux_dp</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="design-staging">
<span id="dev-design-staging"></span><h2>Design Staging</h2>
<section id="take-inventory-of-the-target-board">
<span id="dev-take-inventory-of-the-target-board"></span><h3>Take inventory of the target board</h3>
<p><strong>BACKGROUND:</strong></p>
<p>Per the OpenCPI Platform Development Guide, the target board was examined to identify the devices and interfaces that are required to support a functioning OSP. One of the main focuses of this phase is to identify the device(s) that will be used as an OpenCPI “container(s)”, which is where an application or portion of an application can be deployed. The interfaces between all devices are examined to determine if they are necessary for command/control or to transport payload data within an OSP. It is necessary to establish which device or interconnect to an external device serves as the “main processor”, and whose responsibility it is to perform system level functionality like, command/control, and possibly, transportation of payload data. This serves as an aid for determining the amount of work necessary to develop an OSP for the target platform.</p>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Identify container(s)</p></li>
<li><p>Identify interface(s)</p></li>
</ul>
<p>These items were sorted into the following categories based on their current support within the OpenCPI framework: <strong>Yes, No, Partial.</strong> For items where there is partial or no support, a research phase was conducted to ascertain the amount of development that is required to understand the level of support that is needed by the target platform. The “level of support” varies based on the configuration for a given device versus the requirements of the target platform. For example, although the digital interface of the Analog Devices transceiver may support LVDS and CMOS electrical standards, the target platform may implement support of only the LVDS standard, and therefore it may not be necessary to also enable support for CMOS. However, implementing support for CMOS standard could be added at a later time. This also highlights any additional requirement(s) for developing support for new tooling or other features that must be integrated into the OpenCPI framework to properly target the devices, such as FPGA build tools or software cross-compilers. In many cases, this initial investigation into the platform can be accomplished from vendor provided documentation, such as,  the User’s guide, board schematics and wiring diagrams. In cases where this documentation is insufficient, analysis must be performed with access to the board directly. However, it is also possible that not enough information can be gathered to successfully develop an OSP, but this should be determined upon the completion of the phases described above.</p>
<p><strong>IMPLEMENTATION:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 31%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tool/Device/Interface/Function</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Framework Support (Yes/No/Partial)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>T: FPGA build tools</p></td>
<td><p>Xilinx Vivado 2021.1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>D: Xilinx XCZU48DR-FFVG1517-2-E</p></td>
<td><p>Zynq UltraScale+ RFSoC</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>D: Skyworks Si5341A</p></td>
<td><p>Clock Generator</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>D: TI LMX2594</p></td>
<td><p>Wideband Freq Synth</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>D: VCC6-LAB-122M8800000</p></td>
<td><p>I2C Programmable XO</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-odd"><td><p>D: DDR4</p></td>
<td><p>External Memory</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-even"><td><p>D: XADC</p></td>
<td><p>Low Rate ADC</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-odd"><td><p>D: Display Port</p></td>
<td><p>Video Monitor</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-even"><td><p>D: SATA</p></td>
<td><p>High Speed Serial</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-odd"><td><p>D: IRIG</p></td>
<td><p>GPS Sync</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-even"><td><p>I: Slots: FMC+</p></td>
<td><p>Slots for daughtercards</p></td>
<td><p>Existing</p></td>
</tr>
<tr class="row-odd"><td><p>I: x8 PCI Express Gen3</p></td>
<td><p>Interface</p></td>
<td><p>Partial</p></td>
</tr>
<tr class="row-even"><td><p>I: GPIO</p></td>
<td><p>General Purpose I/O</p></td>
<td><p>Existing (May require mods)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="review-vendor-s-reference-design-package">
<span id="dev-review-vendor-s-reference-design-package"></span><h3>Review Vendor’s Reference Design Package</h3>
<p><strong>GOAL:</strong></p>
<ul>
<li><p>Allow the user to become familiar with the target board and its reference design package. By working through the reference design package, the user becomes comfortable with various tools, modifying source code, understanding the build flow (Vivado, Petalinux), creating a microSD card, loading the FPGA and running an application. The build flow steps captured during the review are heavily relied upon throughout much of this guide and its lessons-learned are used during the integration with OpenCPI.</p>
<blockquote>
<div><ul class="simple">
<li><p>Review its documentation and work though the reference designs that targets the processor and/or the FPGA.</p></li>
<li><p>(OPTIONAL) Verify that the reference design can be modified and rebuilt so that a value of a register is set at build-time and readback during run-time. Then build the bitstream, create an image via Petalinux, install the artifacts onto the ZRF8 and readback the custom register value.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic simple">
<li><p>Install and build reference design package</p></li>
<li><p>Review the vendor provided documentation, such as, but not limited to:</p>
<ol class="arabic simple">
<li><p>HiTech-Global ZRF8 Users Guide</p></li>
</ol>
</li>
</ol>
<dl class="simple">
<dt>cpiadmin deploy platform xilinx21_1_aarch64 zrf8_48dr</dt><dd><ol class="arabic simple">
<li><p>HiTech-Global ZRF8 Schematic</p></li>
</ol>
</dd>
</dl>
<ol class="arabic simple">
<li><p>Run the various examples application(s)</p></li>
<li><p>Explore all that has been provided and make note of any special build or run time steps, which may be reused in the OpenCPI development flow:</p>
<ol class="arabic simple">
<li><p>Building the bitstream</p></li>
<li><p>Building the petalinux project</p></li>
<li><p>Booting the ZRF8</p></li>
<li><p>Setting up the microSD card</p></li>
<li><p>Loading of the FPGA</p></li>
<li><p>Runing Application(s)</p></li>
</ol>
</li>
<li><p>(OPTIONAL) Once you have become familiar with the out-of-the-box reference design, convince yourself that you can edit the design by including a register for readback, which supports read/write or has a constant value. The details are left to the reader.</p></li>
</ol>
</section>
</section>
<section id="opencpi-staging">
<span id="dev-opencpi-staging"></span><h2>OpenCPI Staging</h2>
<section id="install-the-opencpi-framework">
<span id="dev-install-the-framework"></span><h3>Install the OpenCPI framework</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Install the OpenCPI Framework to use for development of the OSP</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>This Guide uses the following Framework branch and commit ID</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://gitlab.com/opencpi/opencpi/-/tree/3420-support-for-rcc-platform-xilinx21_1_aarch64">3420-support-for-rcc-platform-xilinx21_1_aarch64</a></p></li>
<li><p>git commit ID - <strong>cbcd6fa7fa477e72031181c997a5a666487b0eb9</strong></p></li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p>Clone the OpenCPI framework</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://gitlab.com/opencpi/opencpi.git</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">cbcd6fa7fa477e72031181c997a5a666487b0eb9</span></code></p>
</li>
<li><p>Install the framework</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">./scripts/install-opencpi.sh</span> <span class="pre">--minimal</span></code></p>
</li>
</ol>
</section>
<section id="configure-a-host-terminal-for-opencpi-development">
<span id="dev-configure-a-host-terminal-for-opencpi-development"></span><h3>Configure a host terminal for OpenCPI development</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>As a convenience, below are the steps for configuring a Host terminal for the OpenCPI development environment</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>After the OpenCPI framework has been installed, source the OpenCPI framework setup script</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
</li>
<li><p>Ensure that the environment is configured for the <strong>desired version of Vivado</strong> and its license file</p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_XILINX_VIVADO_VERSION=2021.1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">OCPI</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env | grep OCPI
OCPI_TOOL_PLATFORM=centos7
OCPI_PREREQUISITES_DIR=/home/user/opencpi/prerequisites
OCPI_TOOL_OS_VERSION=c7
OCPI_CDK_DIR=/home/user/opencpi/cdk
OCPI_XILINX_VIVADO_VERSION=2021.1
OCPI_ROOT_DIR=/home/user/opencpi
OCPI_TOOL_OS=linux
OCPI_TOOL_PLATFORM_DIR=/home/user/opencpi/project-registry/ocpi.core/exports/rcc/platforms/centos7
OCPI_TOOL_ARCH=x86_64
OCPI_TOOL_DIR=centos7
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
<section id="modifications-to-the-install-and-deploy-scripts">
<span id="dev-modifications-to-the-install-and-deploy-scripts"></span><h3>Modifications to the Install and Deploy scripts</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>By default, the <code class="docutils literal notranslate"><span class="pre">testbias</span></code> (Control Plane + Data Plane) HDL assembly is built as part of the installation process for a given OSP, and this bitstream is included in the deployment of said OSP. The purpose of these modifications are to replace the <code class="docutils literal notranslate"><span class="pre">testbias</span></code> HDL assembly with the <code class="docutils literal notranslate"><span class="pre">pattern_capture</span></code> (Control Plane <strong>ONLY</strong>) HDL assembly  so that its bitstream is built, and the <code class="docutils literal notranslate"><span class="pre">pattern_capture.xml</span></code> application is deployed, thus making it the <code class="docutils literal notranslate"><span class="pre">new</span></code> default assembly and application for assessing the behavior of the Control Plane.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>So that the Control Plane application (<code class="docutils literal notranslate"><span class="pre">pattern_capture.xml</span></code>) is included in the list of OASs that are exported to <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/cdk/&lt;rcc-platform&gt;/sdcard*/opencpi/applications</span></code>, create a symbolic link within the <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/projects/assets/applications/</span></code> to <code class="docutils literal notranslate"><span class="pre">pattern_capture.xml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/assets/applications/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">pattern_capture/pattern_capture.xml</span> <span class="pre">./pattern_capture.xml</span></code></p>
</li>
<li><p>Edit the following scripts to target the assembly <code class="docutils literal notranslate"><span class="pre">pattern_capture_asm</span></code>, rather than the <code class="docutils literal notranslate"><span class="pre">testbias</span></code> assembly:</p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/tools/scripts/export-platform-to-framework.sh</span></code> to target <code class="docutils literal notranslate"><span class="pre">pattern_capture_asm</span></code></p>
<p>FROM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tbz=projects/assets/exports/artifacts/ocpi.assets.testbias_${platform}_base.hdl.0.${platform}.bitz
</pre></div>
</div>
<p>TO:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tbz=projects/assets/exports/artifacts/ocpi.assets.pattern_capture_asm_${platform}_base.hdl.0.${platform}.bitz
</pre></div>
</div>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/tools/scripts/ocpiadmin.sh</span></code> to target <code class="docutils literal notranslate"><span class="pre">pattern_capture_asm</span></code></p>
<p>FROM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ocpidev -d projects/assets build --hdl-platform=$platform hdl ${minimal:+--workers-as-needed} assembly testbias
</pre></div>
</div>
<p>TO:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ocpidev -d projects/assets build --hdl-platform=$platform hdl ${minimal:+--workers-as-needed} assembly pattern_capture_asm
</pre></div>
</div>
<p><strong>AND</strong></p>
<p>FROM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;HDL platform </span><span class="se">\&quot;</span><span class="s2">$platform</span><span class="se">\&quot;</span><span class="s2"> built, with one HDL assembly (testbias) built for testing.&quot;</span>
</pre></div>
</div>
<p>TO:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;HDL platform </span><span class="se">\&quot;</span><span class="s2">$platform</span><span class="se">\&quot;</span><span class="s2"> built, with one HDL assembly (pattern_capture_asm) built for testing.&quot;</span>
</pre></div>
</div>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/tools/scripts/deploy-platform.sh</span></code> to target <code class="docutils literal notranslate"><span class="pre">pattern_capture_asm</span></code></p>
<p>FROM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cp $verbose -L ../projects/assets/hdl/assemblies/testbias/container-testbias_${hdl_platform}_base/target-*/*.bitz \
   $sd/opencpi/artifacts
</pre></div>
</div>
<p>TO:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cp $verbose -L ../projects/assets/hdl/assemblies/pattern_capture_asm/container-pattern_capture_asm_${hdl_platform}_base/target-*/*.bitz \
   $sd/opencpi/artifacts
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</section>
<section id="setup-the-software-cross-compiler">
<span id="dev-setup-the-software-cross-compiler"></span><h3>Setup the Software cross-compiler</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To establish the software cross-complier</p></li>
<li><p>To setup the OpenCPI functionality of the <code class="docutils literal notranslate"><span class="pre">ZynqReleases</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span></code> Xilinx directories</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>The following commands are outlined in the <a class="reference external" href="https://opencpi.gitlab.io/releases/latest/docs/OpenCPI_Installation_Guide.pdf">OpenCPI Installation Guide</a></p>
<ol class="arabic">
<li><p>Download the prebuilt Linux image for the <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> board platform</p></li>
<li><p>Go to the <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1884029195/2021.1+Release">Xilinx Wiki page</a></p></li>
<li><p>Navigate/scroll to the <code class="docutils literal notranslate"><span class="pre">Downloads</span></code> section of the page</p></li>
<li><p>Download the <code class="docutils literal notranslate"><span class="pre">2021.1-zcu104-release.tar.xz</span></code></p></li>
<li><p>Setup <code class="docutils literal notranslate"><span class="pre">Xilinx/ZynqReleases/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">/opt/Xilinx/ZynqReleases/2021.1/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/Downloads</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">2021.1-zcu104-release.tar.xz</span> <span class="pre">/opt/Xilinx/ZynqReleases/2021.1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">&lt;user&gt;:users</span> <span class="pre">/opt/Xilinx/ZynqReleases</span></code></p>
<ul class="simple">
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">smith:users</span> <span class="pre">/opt/Xilinx/ZynqReleases</span></code></p></li>
<li><p>Note: This may require adjusting the permissions for <code class="docutils literal notranslate"><span class="pre">/opt/Xilinx/ZynqReleases</span></code> or its subdirectories</p></li>
</ul>
</li>
<li><p>Setup <code class="docutils literal notranslate"><span class="pre">Xilinx/git/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">/opt/Xilinx/git</span></code></p>
<ol class="arabic">
<li><p>Download <code class="docutils literal notranslate"><span class="pre">linux-xlnx</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/Downloads</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/Xilinx/linux-xlnx.git</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">linux-xlnx</span> <span class="pre">/opt/Xilinx/git</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">&lt;user&gt;:users</span> <span class="pre">/opt/Xilinx/git</span></code></p>
</li>
<li><p>Download <code class="docutils literal notranslate"><span class="pre">u-boot-xlnx</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/Downloads</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/Xilinx/u-boot-xlnx.git</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">u-boot-xlnx</span> <span class="pre">/opt/Xilinx/git</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">&lt;user&gt;:users</span> <span class="pre">/opt/Xilinx/git</span></code></p>
</li>
</ol>
</li>
</ol>
</section>
<section id="install-and-deployment">
<span id="dev-install-xilinx21-1-aarch64-rcc-platfrom"></span><h3>Install and Deployment</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To install and deploy the RCC Platform <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> and the HDL Platform <code class="docutils literal notranslate"><span class="pre">zcu104</span></code></p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><strong>Install: xilinx21_1_aarch64 (an RCC platform)</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">opencpi/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">install</span> <span class="pre">platform</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">--minimal</span></code></p>
</div></blockquote>
<p><strong>Install: zcu104 (an HDL platform)</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">opencpi/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">install</span> <span class="pre">platform</span> <span class="pre">zcu104</span> <span class="pre">--minimal</span></code></p>
</div></blockquote>
<p><strong>Deploy: zcu104 with xilinx21_1_aarch64</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">deploy</span> <span class="pre">platform</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">zcu104</span></code></p>
</div></blockquote>
</section>
<section id="benchmark-testing-the-opencpi-zcu104-osp">
<span id="dev-benchmark-testing-the-opencpi-zcu104-osp"></span><h3>Benchmark testing the OpenCPI zcu104 OSP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Gain a benchmark understanding of the build-time and run-time utilities as they are performed for the HDL platform <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> when paired with the RCC platform <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code>.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic simple">
<li><p>Build <code class="docutils literal notranslate"><span class="pre">known</span> <span class="pre">good</span></code> HDL and RCC platforms to aid in the development of the OSP.</p></li>
<li><p>Understand the impact of the contents of the <code class="docutils literal notranslate"><span class="pre">zcu104.exports</span></code> file by reviewing the outputs of install/deploy of the <code class="docutils literal notranslate"><span class="pre">zcu104</span></code></p></li>
<li><p>Build the <code class="docutils literal notranslate"><span class="pre">canary</span></code> <strong>Control Plane</strong> (CP) HDL bitstreams and run its application</p></li>
<li><p>Build the <code class="docutils literal notranslate"><span class="pre">canary</span></code> <strong>Data Plane</strong> (DP) HDL bitstreams and run its application</p></li>
<li><p>Build the Component Unit Tests and run them on the <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> to obtain benchmark performance metrics.</p></li>
</ol>
</section>
<section id="create-an-opencpi-project-for-the-zrf8">
<span id="dev-create-an-opencpi-project-for-the-zrf8"></span><h3>Create an OpenCPI project for the ZRF8</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To create a skeleton project directory for the OSP and add to the project-registry</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Create a project, under <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/projects/osps</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/osps/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">create</span> <span class="pre">project</span> <span class="pre">ocpi.osp.hitech-global</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">ocpi.osp.hitech-global</span></code></p>
</li>
<li><p>Clean up the following files</p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">project.xml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">project.rst</span></code></p>
</li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(if $(realpath $(OCPI_CDK_DIR)),,\
  $(error The OCPI_CDK_DIR environment variable is not set correctly.))
  # This is the Makefile for the ocpi.osp.xilinx project.
include $(OCPI_CDK_DIR)/include/project.mk
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">Project.mk</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PackageName</span><span class="o">=</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span>
<span class="n">PackagePrefix</span><span class="o">=</span><span class="n">ocpi</span>
<span class="n">ProjectDependencies</span><span class="o">=</span><span class="n">ocpi</span><span class="o">.</span><span class="n">platform</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">assets</span>
<span class="n">ComponentLibraries</span><span class="o">+=</span><span class="n">misc_comps</span> <span class="n">util_comps</span> <span class="n">dsp_comps</span> <span class="n">comms_comps</span>
</pre></div>
</div>
</li>
<li><p>Register the project</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">register</span> <span class="pre">project</span></code></p>
</li>
<li><p>Confirm that the <code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global</span></code> project is registered</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">show</span> <span class="pre">registry</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------------------------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Project</span> <span class="n">Package</span><span class="o">-</span><span class="n">ID</span>       <span class="o">|</span> <span class="n">Path</span> <span class="n">to</span> <span class="n">Project</span>                                         <span class="o">|</span> <span class="n">Valid</span><span class="o">/</span><span class="n">Exists</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">------------------------</span> <span class="o">|</span> <span class="o">-------------------------------------------------------</span> <span class="o">|</span> <span class="o">------------</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span>   <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">osps</span><span class="o">/</span><span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span> <span class="o">|</span> <span class="kc">True</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">core</span>                <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">core</span>                        <span class="o">|</span> <span class="kc">True</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">tutorial</span>            <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">tutorial</span>                    <span class="o">|</span> <span class="kc">True</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">assets</span>              <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">assets</span>                      <span class="o">|</span> <span class="kc">True</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">platform</span>            <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">platform</span>                    <span class="o">|</span> <span class="kc">True</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">assets_ts</span>           <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">assets_ts</span>                   <span class="o">|</span> <span class="kc">True</span>         <span class="o">|</span>
<span class="o">-----------------------------------------------------------------------------------------------------</span>
</pre></div>
</div>
</li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> part number <code class="docutils literal notranslate"><span class="pre">xczu48dr</span></code> in the <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/tools/include/hdl/hdl-targets.xml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">family</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;zynq_ultra&#39;</span> <span class="n">toolset</span><span class="o">=</span><span class="s1">&#39;vivado&#39;</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;xczu3cg-2-sbva484e&#39;</span>
         <span class="n">parts</span><span class="o">=</span><span class="s1">&#39;xczu28dr xczu9eg xczu7ev xczu3cg xczu48dr&#39;</span><span class="o">/&gt;</span>
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">fmc_plus.xml</span></code> card-spec has been provided in the <code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global</span></code> <a class="reference external" href="https://gitlab.com/opencpi/osp/ocpi.osp.hitech-global">repository</a>. The <code class="docutils literal notranslate"><span class="pre">fmc_plus.xml</span></code> card-spec is located in the <code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global/hdl/platforms/zrf8_48dr/guide</span></code>. Implement the <code class="docutils literal notranslate"><span class="pre">fmc_plus.xml</span></code> card-spec within the <code class="docutils literal notranslate"><span class="pre">projects/core/hdl/cards/specs/</span></code> directory.</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">fmc_plus.xml</span> <span class="pre">/home/user/opencpi/projects/core/hdl/cards/specs</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">unregister</span> <span class="pre">project</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">register</span> <span class="pre">project</span></code></p>
</li>
</ol>
</section>
</section>
<section id="enable-opencpi-hdl-control-plane">
<span id="dev-enable-opencpi-hdl-control-plane"></span><h2>Enable OpenCPI HDL Control Plane</h2>
<section id="configure-ps-for-cp">
<span id="dev-configure-ps-for-cp"></span><h3>Configure PS for CP</h3>
<p><strong>GOAL:</strong></p>
<ul>
<li><p>Obtain a <strong>Processing System</strong> (PS) core IP which is precisely configured for the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code>, that will be wrapped and normalized for OpenCPI signaling and made available to be instanced in the Platform Worker. The steps to acheive this goal start by leveraging the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> vendor reference design to isolate the Processing System (PS) core IP’s source code.</p></li>
<li><p>Configure the PS core IP to enable and configure signals/ports, per the requirements of the OpenCPI HDL Control Plane control software for the Zynq UltraScale+ RFSoC devices:</p>
<blockquote>
<div><ul class="simple">
<li><p>Clock(s)</p></li>
<li><p>Reset(s)</p></li>
<li><p>An AXI Master interface - Memory mapping must match with that defined in <code class="docutils literal notranslate"><span class="pre">HdlZynq.hh</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>The product of this section is the PS core IP HDL primitive that supports the Control Plane.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Be sure to have the Reference Design built and installed from the <a class="reference internal" href="#dev-review-vendor-s-reference-design-package"><span class="std std-ref">Review Vendor’s Reference Design Package</span></a> section.</p></li>
<li><p>Create a copy of the reference design and create a <code class="docutils literal notranslate"><span class="pre">Control-Plane</span></code> only version <code class="docutils literal notranslate"><span class="pre">zrf8_48dr_cp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">&lt;reference_design&gt;/</span> <span class="pre">./zrf8_48dr_cp</span></code></p>
</li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr_cp</span></code> vivado project</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/Xilinx/Vivado/2021.1/settings64.sh</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">vivado</span> <span class="pre">pl_core.xpr</span></code></p>
</li>
<li><p>Remove the following files from the <code class="docutils literal notranslate"><span class="pre">Design</span> <span class="pre">Sources</span></code></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">axi_reg_if</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pulse_converter</span></code></p></li>
</ol>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Open</span> <span class="pre">Block</span> <span class="pre">Design</span></code></p></li>
<li><p>Open the Block Design for editing</p>
<ol class="arabic">
<li><p>Remove all modules except the Zynq UltraScale+ RFSoC IP <code class="docutils literal notranslate"><span class="pre">zynq_ultra_ps_e_0</span></code></p></li>
<li><p>Remove all signals</p></li>
<li><p>Edit the PS core IP (Double Click <code class="docutils literal notranslate"><span class="pre">zynq_ultra_ps_e_0</span></code>):</p>
<ol class="arabic">
<li><p><strong>Disable I2C</strong></p>
<p>I/O Configuration -&gt; Low-Speed -&gt; I/O Periperals -&gt; I2C -&gt; I2C 0</p>
</li>
<li><p><strong>Disable SPI</strong></p>
<p>I/O Configuration -&gt; Low-Speed -&gt; I/O Peripherals -&gt; SPI -&gt; SPI 0</p>
</li>
<li><p><strong>Disable TTC</strong></p>
<p>I/O Configuration -&gt; Low-Speed -&gt; Processing Unit -&gt; TTC -&gt; TTC 3</p>
</li>
<li><p><strong>Disable PL to PS Interrupts</strong></p>
<p>PS-PL Configuration -&gt; General -&gt; Interrupts -&gt; PL to PS -&gt; IRQ0[0-7] -&gt; 0</p>
</li>
<li><p><strong>Disable the second Master Interface AXI HPM1 FPD:</strong></p>
<p>PS-PL Configuration -&gt; PS-PL Interfaces -&gt; Master Interface -&gt; AXI HPM1 FPD</p>
</li>
<li><p><strong>Configure the Master Interface AXI HPMO FPD for 32 bit</strong></p>
<p>PS-PL Configuration -&gt; PS-PL Interfaces -&gt; Master Interface -&gt; AXI HPM0 FPD -&gt; AX0 HPM1 FPD Data Width -&gt; 32</p>
</li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">OK</span></code></p></li>
</ol>
</li>
<li><p>Make a connection from <code class="docutils literal notranslate"><span class="pre">pl_clk0</span></code> to <code class="docutils literal notranslate"><span class="pre">maxihpm0_fpd_aclk</span></code></p></li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Regenerate</span> <span class="pre">Layout</span></code></p></li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Validate</span> <span class="pre">Design</span> <span class="pre">(F6)</span></code></p></li>
<li><p>Externalize the <code class="docutils literal notranslate"><span class="pre">M_AXI_HPM0_FDP</span></code> port (Ctrl + t)</p></li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Validate</span> <span class="pre">Design</span> <span class="pre">(F6)</span></code> -&gt; Auto assign address -&gt; Yes</p></li>
<li><p>Edit the Address Editor to match the expected OpenCPI adrress as described here <code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/runtime/hdl/include/HdlZynq.hh</span></code> (<code class="docutils literal notranslate"><span class="pre">M_HP0_PADDR</span> <span class="pre">0xA800000</span></code>)</p>
<ol class="arabic simple">
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">Address</span> <span class="pre">Editor</span></code> ribbon</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">M_AXI_HPM0_FPD_0</span></code> Master Base Address to <code class="docutils literal notranslate"><span class="pre">0x00_A800_0000</span></code></p></li>
<li><p>Re-validate the design <code class="docutils literal notranslate"><span class="pre">Validate</span> <span class="pre">Design</span> <span class="pre">(F6)</span></code></p></li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Flow</span> <span class="pre">Navigator</span> <span class="pre">window</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">INTEGRATOR</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">Block</span> <span class="pre">Design</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Generate</span></code></p></li>
</ol>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Sources</span></code> tab and <code class="docutils literal notranslate"><span class="pre">Hierarchy</span></code> view, expand the <code class="docutils literal notranslate"><span class="pre">design_1_wrapper</span></code> and right mouse click the <code class="docutils literal notranslate"><span class="pre">design_1_i</span></code> design and click <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">HDL</span> <span class="pre">Wrapper</span></code> -&gt; OK</p></li>
<li><p>Export an <code class="docutils literal notranslate"><span class="pre">.xsa</span></code> file</p>
<ul class="simple">
<li><p>File -&gt; Export -&gt; Export Hardware…-&gt; Next -&gt; Pre-synthesis -&gt; Finish</p></li>
<li><p>Leave the default export location <code class="docutils literal notranslate"><span class="pre">pl_core</span></code></p></li>
</ul>
</li>
</ol>
</li>
<li><p>Close Vivado</p></li>
<li><p>The Block Design should look as follows:</p></li>
</ol>
<figure class="align-center" id="id7">
<img alt="ZRF8 PS Control Plane Block Design" src="../../../../_images/zrf8_48dr_cp.png" />
<figcaption>
<p><span class="caption-number">Figure 1: </span><span class="caption-text">ZRF8 PS Control Plane Block Design</span></p>
</figcaption>
</figure>
</section>
<section id="create-hdl-primitive-for-cp">
<span id="dev-create-hdl-primitive-for-cp"></span><h3>Create HDL Primitive for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Create an OpenCPI HDL primitive that wraps the Zynq UltraScale+ RFSoC PS core IP which has been configured per the settings of the <code class="docutils literal notranslate"><span class="pre">ZRF8</span></code>. As the <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> OpenCPI HDL Platform targets the same device family, its HDL primitive module is used as a reference implementation for this task.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><strong>CODEBLOCK</strong>: The code block for the various files that make up the HDL Primitive can be found in the following directory of the ocpi.osp.hitech-global repository:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span><span class="o">/</span><span class="n">hdl</span><span class="o">/</span><span class="n">platforms</span><span class="o">/</span><span class="n">zrf8_48dr</span><span class="o">/</span><span class="n">guide</span><span class="o">/</span><span class="n">code</span><span class="o">-</span><span class="n">blocks</span><span class="o">/</span><span class="n">control</span><span class="o">-</span><span class="n">plane</span><span class="o">/</span><span class="n">primitives</span><span class="o">/</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p>Setup terminal for OpenCPI development</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_XILINX_VIVADO_VERSION=2021.1</span></code></p>
</li>
<li><p>Create an OpenCPI HDL primitive library, named <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">projects/osps/ocpi.osp.hitech-global</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">create</span> <span class="pre">hdl</span> <span class="pre">primitive</span> <span class="pre">library</span> <span class="pre">zynq_ultra_zrf8_48dr</span></code></p>
</li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">primitives</span></code> level Makefile</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">&lt;ocpi.osp.hitech-global/hdl/primitives/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/projects/platform/hdl/primitives/Makefile</span> <span class="pre">./</span></code></p>
</li>
<li><p>Clean up the following files</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">&lt;ocpi.osp.hitech-global&gt;/hdl/primitives/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">primitives.xml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">primitives.rst</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">zynq_ultra_zrf8_48dr.xml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">zynq_ultra_zrf8_48dr.rst</span></code></p>
</li>
<li><p>From the Vivado project modified in  <span class="xref std std-ref">dev-Configure-PS-for-Control-Plane</span>, which is specific to using the vendor’s reference design for configuring the PS core IP for the <code class="docutils literal notranslate"><span class="pre">ZRF8</span></code>, browse to the generated artifacts directory, and copy them into the newly created OpenCPI HDL primitive library.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/pl_core.gen/sources_1/bd/design_1/ip</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">design_1_zynq_ultra_ps_e_0_0/</span> <span class="pre">&lt;ocpi.osp.hitech-global&gt;/hdl/primitives/zynq_ultra_zrf8_48dr</span></code></p>
</li>
<li><p>Since the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> is very similar to the <code class="docutils literal notranslate"><span class="pre">zcu104</span></code>, simply copy and rename a couple files from the <code class="docutils literal notranslate"><span class="pre">platform/hdl/primitive/zynq_ultra</span></code> HDL primitive library into the <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr</span></code> and edit as needed.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/platform/hdl/primitives/zynq_ultra/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">zynq_ultra_pkg.vhd</span>&#160; <span class="pre">&lt;ocpi.osp.hitech-global&gt;/hdl/primitives/zynq_ultra_zrf8_48dr/zynq_ultra_zrf8_48dr_pkg.vhd</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">zynq_ultra_ps.cpp_vhd</span> <span class="pre">&lt;ocpi.osp.hitech-global&gt;/hdl/primitives/zynq_ultra_zrf8_48dr/zynq_ultra_zrf8_48dr_ps.vhd</span></code></p>
</li>
<li><p>Edit the HDL package <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_pkg.vhd</span></code></p>
<ol class="arabic">
<li><p>Change package name from <code class="docutils literal notranslate"><span class="pre">zynq_ultra_pkg</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_pkg</span></code></p></li>
<li><p>Reduce the number of Master ports that are supported from 2 to 1.</p>
<p>From: <code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">C_M_AXI_HP_COUNT</span> <span class="pre">:</span> <span class="pre">natural</span> <span class="pre">:=</span> <span class="pre">2</span></code></p>
<p>To: <code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">C_M_AXI_HP_COUNT</span> <span class="pre">:</span> <span class="pre">natural</span> <span class="pre">:=</span> <span class="pre">1</span></code></p>
</li>
<li><p>Change primitive component name from <code class="docutils literal notranslate"><span class="pre">zynq_ultra_ps</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_ps</span></code></p></li>
<li><p>Comment out the <code class="docutils literal notranslate"><span class="pre">s_axi_hp_in</span></code> and <code class="docutils literal notranslate"><span class="pre">s_axi_hp_out</span></code> ports</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are for the Data Plane and will be added back into the design in a later section.</p>
</div>
</li>
</ol>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_ps.vhd</span></code>, to remove all C++ preprocessing code and to normalize the interface of the generated PS core IP to OpenCPI Control Plane signaling.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This file edit is very intricate and in depth. As you read through this section it is encouraged that you use a comparison tool and compare the CODEBLOCK of this file (outlined at the top of this section) with the file that is currently in place in your project. This will give you the best overview of the step-by-step process in this section.</p>
</div>
<ol class="arabic">
<li><p>Change library names from:</p>
<p>from <code class="docutils literal notranslate"><span class="pre">library</span> <span class="pre">zynq_ultra</span></code> to <code class="docutils literal notranslate"><span class="pre">library</span> <span class="pre">zynq_ultra_zrf8_48dr</span></code></p>
<p>from <code class="docutils literal notranslate"><span class="pre">zynq_ultra.zynq_ultra_pkg.all</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr.zynq_ultra_zrf8_48dr_pkg.all</span></code></p>
</li>
<li><p>Change entity name:</p>
<p>from <code class="docutils literal notranslate"><span class="pre">zynq_ultra_ps</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_ps</span></code></p>
</li>
<li><p>Comment out any lines containing:</p>
<p><code class="docutils literal notranslate"><span class="pre">s_axi_hp_in</span></code>, <code class="docutils literal notranslate"><span class="pre">s_axi_hp_out</span></code></p>
</li>
<li><p>Change architecture name:</p>
<p>from <code class="docutils literal notranslate"><span class="pre">zynq_ultra_ps</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_ps</span></code></p>
</li>
<li><p>Change the component name:</p>
<p>from <code class="docutils literal notranslate"><span class="pre">PS8_WRAPPER_MODULE</span></code> to <code class="docutils literal notranslate"><span class="pre">design_1_zynq_ultra_ps_e_0_0</span></code></p>
</li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">GENERIC</span></code> ports:</p></li>
<li><p>Remove all ports in the entity except for the following:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maxihpm0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp1_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp3_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxigp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp3_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp4_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp5_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pl_resetn0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pl_clk0</span></code></p></li>
</ol>
</li>
<li><p>Of the remaining ports in the entity, comment out the following  ports from the entity
(these are for the Data Plane, and will be added back later):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">saxihp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp1_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp3_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxigp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp3_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp4_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp5_*</span></code></p></li>
</ol>
</li>
<li><p>Replace the <code class="docutils literal notranslate"><span class="pre">PS8_WRAPPER_MODULE</span></code> that is in the architecture declaration and body with
<code class="docutils literal notranslate"><span class="pre">design_1_zynq_ultra_ps_e_0_0</span></code></p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">PORT</span> <span class="pre">MAP</span></code> perfrom the same removal and commenting as in the entity</p>
<ol class="arabic simple">
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">GENERIC</span></code> ports</p></li>
<li><p>Remove all ports in the entity except for the following:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maxihpm0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp1_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp3_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxigp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp3_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp4_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp5_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pl_resetn0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pl_clk0</span></code></p></li>
</ol>
</li>
</ol>
</li>
<li><p>Of the remaining ports in the entity, comment out the following  ports from the entity
(these are for the Data Plane, and will be added back later):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">saxihp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp1_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp3_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxigp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp3_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp4_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp5_*</span></code></p></li>
</ol>
</li>
<li><p>All that should remain are the following ports:</p>
<ol class="arabic simple">
<li><p>gm: for i in - to C_M_AXI_HP_COUNT-1 code block (Control Plane Ports)</p></li>
<li><p>gs: for i in 0 to C_S_AXI_HP_COUNT-1 generate code block (Data Plane Ports)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxihpm0_fpd_aclk</span></code> (Control Plane Clock - destination)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxigp0_*</span></code> (Control Plane Ports)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxihp{0,1,2,3}_fpd_aclk</span></code> (Data Plane Clocks - destination)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxigp{2,3,4,5}</span></code> (Data Plane Ports)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pl_resetn0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pl_clk0</span></code> (Control Plane Clock - source)</p></li>
</ol>
</li>
<li><p>Of the remaining ports, the following ports listed should be commented out (these are for the
Data Plane, and will be added back later)</p>
<ol class="arabic simple">
<li><p>gs: for i in 0 to C_S_AXI_HP_COUNT-1 generate code block (Data Plane Ports)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxihp{0,1,2,3}_fpd_aclk</span></code> (Data Plane Clocks)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxigp{2,3,4,5}</span></code> (Data Plane Ports)</p></li>
</ol>
</li>
</ol>
</li>
<li><p>Create the primitive library’s <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> to specify all of the dependencies:</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global/hdl/primitives/zynq_ultra_zrf8_48dr/Makefile</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Libraries=fixed_float ocpi axi sdp platform

SourceFiles= \
    zynq_ultra_zrf8_48dr_pkg.vhd \
    zynq_ultra_zrf8_48dr_ps.vhd \
    design_1_zynq_ultra_ps_e_0_0/design_1_zynq_ultra_ps_e_0_0.dcp

OnlyTargets=zynq_ultra

include $(OCPI_CDK_DIR)/include/hdl/hdl-library.mk
</pre></div>
</div>
</li>
</ol>
</section>
<section id="build-hdl-primitive-for-cp">
<span id="dev-build-hdl-primitive-for-cp"></span><h3>Build HDL Primitive for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Build the HDL Primitive that is instanced in the HDL Platform Worker</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Return to the top of the project</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/osps/ocpi.osp.hitech-global</span></code></p>
</li>
<li><p>Build the primitive library</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">--hdl-target</span> <span class="pre">zynq_ultra</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ocpidev build --hdl-target zynq_ultra
No HDL platforms specified. No HDL assets will be targeted.
Possible HdlPlatforms are: alst4 alst4x isim matchstiq_z1 ml605 modelsim picoevb x4sim xsim zcu104 zcu106 zed zed_ether zed_ise.
Setting up exports
:
:
:
:
:
============== For library zynq_ultra_zrf8_48dr:
Building the zynq_ultra_zrf8_48dr library for zynq_ultra (target-zynq_ultra/zynq_ultra_zrf8_48dr) 0:()
 Tool &quot;vivado&quot; for target &quot;zynq_ultra&quot; succeeded.  0:00.02 at 10:53:39
Creating directory ../lib/zynq_ultra_zrf8_48dr for library zynq_ultra_zrf8_48dr
No previous installation for gen/zynq_ultra_zrf8_48dr.libs in ../lib/zynq_ultra_zrf8_48dr.
Installing gen/zynq_ultra_zrf8_48dr.libs into ../lib/zynq_ultra_zrf8_48dr
No previous installation for target-zynq_ultra/zynq_ultra_zrf8_48dr.sources in target-zynq_ultra/zynq_ultra_zrf8_48dr.
Installing target-zynq_ultra/zynq_ultra_zrf8_48dr.sources into target-zynq_ultra/zynq_ultra_zrf8_48dr
No previous installation for target-zynq_ultra/zynq_ultra_zrf8_48dr in ../lib/zynq_ultra_zrf8_48dr/zynq_ultra.
Installing target-zynq_ultra/zynq_ultra_zrf8_48dr into ../lib/zynq_ultra_zrf8_48dr/zynq_ultra
</pre></div>
</div>
</li>
</ol>
</section>
<section id="create-hdl-platform-worker-for-cp">
<span id="dev-create-hdl-platform-worker-for-cp"></span><h3>Create HDL Platform Worker for CP</h3>
<p><strong>CODEBLOCK:</strong> The code block for the various files that make up the HDL platform worker can be found in the following directory of the ocpi.osp.hitech-global repository::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span><span class="o">/</span><span class="n">hdl</span><span class="o">/</span><span class="n">platforms</span><span class="o">/</span><span class="n">zrf8_48dr</span><span class="o">/</span><span class="n">guide</span><span class="o">/</span><span class="n">code</span><span class="o">-</span><span class="n">blocks</span><span class="o">/</span><span class="n">control</span><span class="o">-</span><span class="n">plane</span><span class="o">/</span><span class="n">platforms</span><span class="o">/</span>
</pre></div>
</div>
<ol class="arabic">
<li><p>Create HDL Platform Worker</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">opencpi/projects/osps/ocpi.osp.hitech-global</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">create</span> <span class="pre">hdl</span> <span class="pre">platform</span> <span class="pre">zrf8_48dr</span></code></p>
</li>
<li><p>Change directory to HDL Platform Worker</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">hdl/platforms/zrf8_48dr</span></code></p>
</li>
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">zcu104.xml</span></code> into the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> platform worker directory and rename it <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.xml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/projects/platform/hdl/platforms/zcu104/zcu104.xml</span> <span class="pre">./zrf8_48dr.xml</span></code></p>
</li>
<li><p>Edit the newly created <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.xml</span></code></p>
<ol class="arabic simple">
<li><p>Change all references of <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> to <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code></p></li>
<li><p>Delete all <code class="docutils literal notranslate"><span class="pre">specproperty</span></code> elements except for <code class="docutils literal notranslate"><span class="pre">platform</span></code>, i.e. delete nLEDS, nSlots,
nSwitches, slotNames.</p></li>
<li><p>Comment out the Scalable-Data Plane interface, i.e. <code class="docutils literal notranslate"><span class="pre">&lt;sdp</span> <span class="pre">name=...&gt;`</span></code></p></li>
<li><p>Delete Property: <code class="docutils literal notranslate"><span class="pre">useGP1</span></code></p></li>
<li><p>Comment out debug Properties: <code class="docutils literal notranslate"><span class="pre">axi_error</span></code>, <code class="docutils literal notranslate"><span class="pre">sdpDropCount</span></code>, <code class="docutils literal notranslate"><span class="pre">debug_state</span></code>,
<code class="docutils literal notranslate"><span class="pre">debug_state1</span></code>, and <code class="docutils literal notranslate"><span class="pre">debug_state2</span></code></p></li>
<li><p>Remove all signals</p></li>
<li><p>Remove the slot declaration(s) and associated signals and comments</p></li>
</ol>
</li>
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">zcu104.vhd</span></code> into the zrf8_48dr platform worker directory and rename it <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.vhd</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/projects/platform/hdl/platform/zcu104/zcu104.vhd</span> <span class="pre">./zrf8_48dr.vhd</span></code></p>
</li>
<li><p>Edit the newly created <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.vhd</span></code></p>
<ol class="arabic">
<li><p>Comment out Library: <code class="docutils literal notranslate"><span class="pre">platform</span></code></p></li>
<li><p>Change Library: <code class="docutils literal notranslate"><span class="pre">zynq_ultra</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr</span></code></p></li>
<li><p>Change: <code class="docutils literal notranslate"><span class="pre">zynq_ultra.zynq_ultra_pkg.all</span></code> to <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr.zynq_ultra_zrf8_48dr_pkg.all</span></code></p></li>
<li><p>Comment out Library: <code class="docutils literal notranslate"><span class="pre">bsv</span></code> and <code class="docutils literal notranslate"><span class="pre">sdp</span></code></p></li>
<li><p>Change architecture: <code class="docutils literal notranslate"><span class="pre">zcu104_worker</span></code> to <code class="docutils literal notranslate"><span class="pre">zrf8_48dr_worker</span></code></p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">whichGP</span></code> comments and constant</p></li>
<li><p>Comment out the following signals:</p>
<p><code class="docutils literal notranslate"><span class="pre">ps_s_axi_hp_in</span></code>, <code class="docutils literal notranslate"><span class="pre">ps_s_axi_hp_out</span></code>, <code class="docutils literal notranslate"><span class="pre">rst_n</span></code>, <code class="docutils literal notranslate"><span class="pre">my_sdp_out</span></code>, <code class="docutils literal notranslate"><span class="pre">my_sdp_out_data</span></code>,
<code class="docutils literal notranslate"><span class="pre">dbg_state</span></code>, <code class="docutils literal notranslate"><span class="pre">dbg_state1</span></code>, <code class="docutils literal notranslate"><span class="pre">dbg_state2</span></code></p>
</li>
<li><p>Remove signals: <code class="docutils literal notranslate"><span class="pre">count</span></code> <code class="docutils literal notranslate"><span class="pre">ledbuf</span></code> and <code class="docutils literal notranslate"><span class="pre">cnt_t</span></code></p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">:</span> <span class="pre">zynq_ultra_ps</span></code> to <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">:</span> <span class="pre">zynq_ultra_zrf8_48dr_ps</span></code></p></li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">useGP1</span></code> comments</p></li>
<li><p>Change: <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">in.debug</span> <span class="pre">=&gt;</span> <span class="pre">(31</span> <span class="pre">=&gt;</span> <span class="pre">useGP1,</span> <span class="pre">others</span> <span class="pre">=&gt;</span> <span class="pre">'0'),</span></code> to <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">in.debug</span> <span class="pre">=&gt;</span> <span class="pre">(others</span> <span class="pre">=&gt;</span> <span class="pre">'0'),</span></code></p></li>
<li><p>Comment out connections: <code class="docutils literal notranslate"><span class="pre">s_axi_hp_in</span></code>, <code class="docutils literal notranslate"><span class="pre">s_axi_hp_out</span></code>, <code class="docutils literal notranslate"><span class="pre">zynq_ultra_out</span></code>,
<code class="docutils literal notranslate"><span class="pre">zynq_ultra_out_data</span></code>, <code class="docutils literal notranslate"><span class="pre">props_out.sdpDropCount</span></code></p></li>
<li><p>Change : <code class="docutils literal notranslate"><span class="pre">ps_m_axi_gp_out(whichGP)</span></code> to <code class="docutils literal notranslate"><span class="pre">ps_m_axi_gp_out(0)</span></code></p></li>
<li><p>Change : <code class="docutils literal notranslate"><span class="pre">ps_m_axi_gp_in(whichGP)</span></code> to <code class="docutils literal notranslate"><span class="pre">ps_m_axi_gp_in(0)</span></code></p></li>
<li><p>Comment out the <code class="docutils literal notranslate"><span class="pre">sdp2axi</span></code> adapter module</p></li>
<li><p>Remove connections: <code class="docutils literal notranslate"><span class="pre">props_out.switches</span></code>, <code class="docutils literal notranslate"><span class="pre">leds</span></code></p></li>
<li><p>Remove the comments and <code class="docutils literal notranslate"><span class="pre">process</span></code> associated with driving the LEDS</p></li>
</ol>
</li>
<li><p>Create a constraints files named <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.xdc</span></code> and add the following clock constraint</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># OpenCPI additions to the above, which is unmodified from the original</span>

<span class="n">create_clock</span> <span class="o">-</span><span class="n">name</span> <span class="n">clk_fpga_0</span> <span class="o">-</span><span class="n">period</span> <span class="mf">10.000</span> <span class="p">[</span><span class="n">get_pins</span> <span class="o">-</span><span class="n">hier</span> <span class="o">*</span> <span class="o">-</span><span class="nb">filter</span> <span class="p">{</span><span class="n">NAME</span> <span class="o">=~</span> <span class="o">/</span><span class="n">ps</span><span class="o">/</span><span class="n">U0</span><span class="o">/</span><span class="n">inst</span><span class="o">/</span><span class="n">PS8_i</span><span class="o">/</span><span class="n">PLCLK</span><span class="p">[</span><span class="mi">0</span><span class="p">]}]</span>
<span class="n">set_property</span> <span class="n">DONT_TOUCH</span> <span class="n">true</span> <span class="p">[</span><span class="n">get_cells</span> <span class="s2">&quot;ftop/pfconfig_i/zrf8_48dr_i/worker/ps/U0/inst/PS8_i&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">zcu104/Makefile</span></code> to <code class="docutils literal notranslate"><span class="pre">zrf8_48dr/Makefile</span></code> and edit it such that its contents match the provided CODE BLOCK</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">ocpi.osp.hitech-global/hdl/platforms/zrf8_48dr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">opencpi/projects/platform/hdl/platform/zcu104/Makefile</span> <span class="pre">./</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span># The zrf8_48dr platform.
Libraries=zynq_ultra_zrf8_48dr axi sdp
Configuration=base
OnlyTargets=zynq_ultra

include $(OCPI_CDK_DIR)/include/hdl/hdl-platform.mk
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Copy/rename the <code class="docutils literal notranslate"><span class="pre">zcu104/zcu104.mk</span></code> to <code class="docutils literal notranslate"><span class="pre">zrf8_48dr/zrf8_48dr.mk</span></code> and edit it such that its contents match the provided CODE BLOCK</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/projects/platforms/hdl/platforms/zcu104/zcu104.mk</span> <span class="pre">./zrf8_48dr.mk</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HdlPart_zrf8_48dr</span><span class="o">=</span><span class="n">xczu48dr</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">ffvg1517e</span>
<span class="n">HdlRccPlatform_zrf8_48dr</span><span class="o">=</span><span class="n">xilinx21_1_aarch64</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Copy/rename the <code class="docutils literal notranslate"><span class="pre">zcu104/zcu104.exports</span></code> to <code class="docutils literal notranslate"><span class="pre">zrf8_48dr/zrf8_48dr.exports</span></code> and edit it such that its contents match the provided CODE BLOCK</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/projects/platforms/hdl/platforms/zcu104/zcu104.exports</span> <span class="pre">./zrf8_48dr.exports</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Development files for building for this platform</span>
<span class="o">+&lt;</span><span class="n">platform_dir</span><span class="o">&gt;/</span><span class="n">zrf8_48dr</span><span class="o">.</span><span class="n">xdc</span>
<span class="o">+&lt;</span><span class="n">platform_dir</span><span class="o">&gt;/</span><span class="n">zrf8_48dr_bit</span><span class="o">.</span><span class="n">xdc</span>
<span class="o">=&lt;</span><span class="n">platform_dir</span><span class="o">&gt;/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">system</span><span class="o">.</span><span class="n">xml</span>

<span class="c1"># Udev rules for runtime on dev host</span>
<span class="c1"># They are always placed in the udev-rules subdir in the runtime packages</span>
<span class="o">=&lt;</span><span class="n">platform</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="mi">98</span><span class="o">-</span><span class="n">zrf8_48dr</span><span class="o">.</span><span class="n">rules</span> <span class="n">udev</span><span class="o">-</span><span class="n">rules</span><span class="o">/</span>

<span class="c1"># Assume that all the boot files are in the software platforms for now</span>
<span class="o">@&lt;</span><span class="n">platform</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">system</span><span class="o">.</span><span class="n">xml</span> <span class="n">opencpi</span><span class="o">/</span>
<span class="o">@&lt;</span><span class="n">platform</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span> <span class="o">/</span>
<span class="o">@&lt;</span><span class="n">platform</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">rootfs</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="o">/</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Copy/rename the <code class="docutils literal notranslate"><span class="pre">zcu104/98-zcu104.rules</span></code> to <code class="docutils literal notranslate"><span class="pre">zrf8_48dr/98-zrf8_48dr.rules</span></code> and edit such that its contents match the provided CODE BLOCK</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/projects/platforms/hdl/platforms/zcu104/98-zcu104.rules</span> <span class="pre">./98-zrf8_48dr.rules</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UBSYSTEM</span><span class="o">==</span><span class="s2">&quot;tty&quot;</span> <span class="n">ATTRS</span><span class="p">{</span><span class="n">product</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;Cypress-USB2UART-*&quot;</span> <span class="n">SYMLINK</span><span class="o">+=</span><span class="s2">&quot;z3u%n&quot;</span> <span class="n">MODE</span><span class="o">:=</span><span class="s2">&quot;0666&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">zrf8_48dr_bit.xdc</span></code>, which is to remain empty.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When this file is void of contents, it signifies to Vivado that all defaults project settings are acceptable.</p>
</div>
</li>
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">sd_card</span></code> directory</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">sd_card</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/home/user/opencpi/platforms/zynq/zynq_system.xml</span> <span class="pre">./sd_card/system.xml</span></code></p></li>
<li><p>Edit the file to look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">opencpi</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">rcc</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">remote</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">hdl</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">device</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;PL:0&#39;</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;zrf8_48dr&#39;</span><span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="n">hdl</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">container</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">transfer</span> <span class="n">smbsize</span><span class="o">=</span><span class="s1">&#39;128K&#39;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">pio</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span> <span class="n">smbsize</span><span class="o">=</span><span class="s1">&#39;10M&#39;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">dma</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">socket</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">transfer</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">opencpi</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</section>
<section id="build-hdl-platform-worker-for-cp">
<span id="dev-build-hdl-platform-worker-for-cp"></span><h3>Build HDL Platform Worker for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Build the HDL Platform Worker and <code class="docutils literal notranslate"><span class="pre">base</span></code> Platform Configuration</p></li>
<li><p>Verify that the HDL platform is recognized by the framework</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p><strong>Build the HDL platform zrf8_48dr</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/osps/ocpi.osp.hitech-global</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">--hdl-platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--rcc-platform</span> <span class="pre">xilinx21_1_aarch64</span></code></p>
</li>
<li><p>Confirm that the zrf8_48dr is recognized by the framework as a valid HDL platform target:</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">show</span> <span class="pre">platforms</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Platform</span>            <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span> <span class="n">Package</span><span class="o">-</span><span class="n">ID</span>                                 <span class="o">|</span> <span class="n">Target</span>              <span class="o">|</span> <span class="n">HDL</span> <span class="n">Part</span>                   <span class="o">|</span> <span class="n">HDL</span> <span class="n">Vendor</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">------------------</span> <span class="o">-|</span> <span class="o">----</span> <span class="o">|</span> <span class="o">------------------------------------------</span> <span class="o">|</span> <span class="o">-------------------</span> <span class="o">|</span> <span class="o">--------------------------</span> <span class="o">|</span> <span class="o">----------</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">centos7</span>             <span class="o">|</span> <span class="n">rcc</span>  <span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">platforms</span><span class="o">.</span><span class="n">centos7</span>                <span class="o">|</span> <span class="n">linux</span><span class="o">-</span><span class="n">c7</span><span class="o">-</span><span class="n">x86_64</span>     <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>                        <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">xilinx21_1_aarch64</span>  <span class="o">|</span> <span class="n">rcc</span>  <span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">platforms</span><span class="o">.</span><span class="n">xilinx21_1_aarch64</span>     <span class="o">|</span> <span class="n">linux</span><span class="o">-</span><span class="mi">18_3</span><span class="o">-</span><span class="n">aarch64</span>  <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>                        <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">zrf8_48dr</span>           <span class="o">|</span> <span class="n">hdl</span>  <span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span><span class="o">.</span><span class="n">platforms</span><span class="o">.</span><span class="n">zrf8_48dr</span> <span class="o">|</span> <span class="n">zynq_ultra</span>          <span class="o">|</span> <span class="n">xczu3eg</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">sbva484i</span>         <span class="o">|</span> <span class="n">xilinx</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">zcu104</span>              <span class="o">|</span> <span class="n">hdl</span>  <span class="o">|</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">platforms</span><span class="o">.</span><span class="n">zcu104</span>             <span class="o">|</span> <span class="n">zynq_ultra</span>          <span class="o">|</span> <span class="n">xczu7ev</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">ffvc1156e</span>        <span class="o">|</span> <span class="n">xilinx</span>     <span class="o">|</span>
<span class="o">|</span> <span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="install-the-hdl-platform-zrf8-48dr-for-cp">
<span id="dev-install-the-hdl-platform-zrf8-48dr-for-cp"></span><h3>Install the HDL Platform zrf8_48dr for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The goal of this section is to <strong>install</strong> the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> HDL Platform.</p></li>
<li><p>Installation of the <code class="docutils literal notranslate"><span class="pre">ZRF8</span></code> includes building the HDL Container (i.e. bitstream) for verifying
the Control Plane.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>With all previous <a class="reference internal" href="#dev-enable-opencpi-hdl-control-plane"><span class="std std-ref">Enable OpenCPI HDL Control Plane</span></a> sections complete, the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> HDL and <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code>  RCC platform can now be installed and deployed.</p>
<ol class="arabic">
<li><p>Browse to top of the OpenCPI directory</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
</li>
<li><p>Setup terminal for OpenCPI development</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">./cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_XILINX_VIVADO_VERSION=2021.1</span></code></p>
</li>
<li><p><strong>Install: zrf8_48dr (an HDL platform)</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">install</span> <span class="pre">platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--minimal</span></code></p>
</li>
</ol>
</section>
<section id="petalinux-workspace-for-cp">
<span id="dev-petalinux-workspace-for-cp"></span><h3>Petalinux workspace for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The following <a class="reference external" href="https://docs.xilinx.com/r/2021.1-English/ug1144-petalinux-tools-reference-guide">Petalinux Tools Documentation Reference Guide (UG1144)</a> describes the commands and build flow that will be utilized in this section. These steps can be revisted, and will allow consequent bitstreams to be “spot checked”.</p></li>
<li><p>Successful completion of this section is a bootable SD-card image utilizing the Petalinux utility</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Source Petalinux 2021.1</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/Xilinx/Petalinux/2021.1/settings.sh</span></code></p>
</li>
<li><p>Create a petalinux project directory for Control-Plane (cp)</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-create</span> <span class="pre">-t</span> <span class="pre">project</span> <span class="pre">--template</span> <span class="pre">zynqMP</span> <span class="pre">--name</span> <span class="pre">&quot;petalinux_cp&quot;</span></code></p>
</li>
<li><p><strong>Complete the</strong> <a class="reference internal" href="#dev-petalinux-fix-for-zrf8"><span class="std std-ref">Petalinux Fix for ZRF8</span></a> <strong>section</strong></p></li>
<li><p>Import the Hardware Configuration that was exported from the Vivado project. This is the <code class="docutils literal notranslate"><span class="pre">*.xsa</span></code> file that was created during the  File → Export → Export Hardware step.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-config</span> <span class="pre">--get-hw-description=../</span></code></p>
</li>
<li><p>Once the <code class="docutils literal notranslate"><span class="pre">/misc/config</span></code> System Configuration GUI is present in the terminal, continue by: Exit -&gt; Yes</p>
<ol class="arabic">
<li><p>If you are presented with: <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">Incompatible</span> <span class="pre">SDK</span> <span class="pre">installer!</span> <span class="pre">Your</span> <span class="pre">host</span> <span class="pre">gcc</span> <span class="pre">version</span> <span class="pre">is</span> <span class="pre">4.8</span> <span class="pre">and</span> <span class="pre">this</span> <span class="pre">SDK</span> <span class="pre">was</span> <span class="pre">built</span> <span class="pre">by</span> <span class="pre">gcc</span> <span class="pre">higher</span> <span class="pre">version.</span></code>, this can be fixed with the following</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Yocto</span> <span class="pre">Settings</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">[*]</span> <span class="pre">Enable</span> <span class="pre">Buildtools</span> <span class="pre">Extended</span></code></p>
</div></blockquote>
</li>
<li><p>If you are presented with: <code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">generate</span> <span class="pre">meta-plnx-generated</span> <span class="pre">layer</span></code>, this can be fixed with the following command:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">sysctl</span> <span class="pre">-n</span> <span class="pre">-w</span> <span class="pre">fs.inotify.max_user_watches=524288</span></code></p>
</div></blockquote>
</li>
</ol>
</li>
<li><p>Build the project:</p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-build</span></code></p>
</li>
<li><p>Package the <code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code> image</p>
<ul class="simple">
<li><p><strong>The BOOT.BIN must be packaged with the appropriate</strong> <code class="docutils literal notranslate"><span class="pre">pattern_capture_asm_zrf8_48dr_base.bit</span></code> <strong>file. This file was created during the</strong> <a class="reference internal" href="#dev-install-the-hdl-platform-zrf8-48dr-for-cp"><span class="std std-ref">Install the HDL Platform zrf8_48dr for CP</span></a> <strong>section.</strong></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">images/linux</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-package</span> <span class="pre">--boot</span> <span class="pre">--fsbl</span> <span class="pre">--fpga</span> <span class="pre">/home/user/opencpi/projects/assets/hdl/assemblies/pattern_capture_asm/container-pattern_capture_asm_zrf8_48dr_base/target-zynq_ultra/pattern_capture_asm_zrf8_48dr_base.bit</span> <span class="pre">--u-boot</span> <span class="pre">--force</span></code></p>
<p>There should now be a <code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code> in the <code class="docutils literal notranslate"><span class="pre">images/linux</span></code> directory</p>
</li>
</ol>
</section>
<section id="create-cp-boot-artifacts">
<span id="dev-create-cp-boot-artifacts"></span><h3>Create CP Boot Artifacts</h3>
<p><strong>GOAL:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Create Control-Plane boot artifacts for the framework to leverage when the Platform is deployed</p></li>
</ul>
</div></blockquote>
<p><strong>IMPLEMENTATION</strong></p>
<ol class="arabic">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">2021.1-zrf8_48dr-release</span></code> directory to store boot artifacts</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/images/linux</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">2021.1-zrf8_48dr-release</span></code></p>
</li>
<li><p>Copy the boot artifacts into the directory and create a <code class="docutils literal notranslate"><span class="pre">ZynqReleases</span></code> tar</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">BOOT.BIN</span> <span class="pre">boot.scr</span> <span class="pre">2021.1-zrf8_48dr-release</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">cvfz</span> <span class="pre">2021.1-zrf8_48dr-release.tar.xz</span> <span class="pre">2021.1-zrf8_48dr-release</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">2021.1-zrf8_48dr-release.tar.xz</span> <span class="pre">/opt/Xilinx/ZynqReleases/2021.1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">&lt;user&gt;:users</span> <span class="pre">/opt/Xilinx/ZynqReleases/2021.1</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">smith:users</span> <span class="pre">/opt/Xilinx/ZynqReleases</span></code></p></li>
<li><p>Note: This may require adjusting the permissions for <code class="docutils literal notranslate"><span class="pre">/opt/Xilinx/ZynqReleases</span></code> or its subdirectories</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="install-the-rcc-platform-xilinx21-1-aarch64-for-cp">
<span id="dev-install-the-rcc-platform-xilinx21-1-aarch64-for-cp"></span><h3>Install the RCC Platform xilinx21_1_aarch64 for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The goal of this section is to <strong>install</strong> the <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> RCC Platform</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Browse to top of the OpenCPI directory</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
</li>
<li><p>Setup terminal for OpenCPI development</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">./cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_XILINX_VIVADO_VERSION=2021.1</span></code></p>
</li>
<li><p><strong>Reinstall RCC Platform</strong> <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> so that the new <code class="docutils literal notranslate"><span class="pre">2021.1-zrf8_48dr-release.tar.xz</span></code> boot artifacts can be implemented into the framework.</p>
<ol class="arabic">
<li><p>Remove the old <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> from <code class="docutils literal notranslate"><span class="pre">cdk</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/cdk</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">xilinx21_1_aarch64</span></code></p>
</li>
<li><p>Clean out stale build artifacts from <code class="docutils literal notranslate"><span class="pre">core/rcc/platforms/xilinx21_1_aarch64</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core/rcc/platforms/xilinx21_1_aarch64</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">gen/</span> <span class="pre">lib/</span></code></p>
</li>
<li><p>Unregister/Re-register project</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">unregister</span> <span class="pre">project</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">register</span> <span class="pre">project</span></code></p>
</li>
<li><p>Reinstall the RCC platform</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">install</span> <span class="pre">platform</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">--minimal</span></code></p>
</li>
</ol>
</li>
</ol>
</section>
<section id="deploy-the-platforms-for-cp">
<span id="dev-deploy-the-platforms-for-cp"></span><h3>Deploy the Platforms for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To deploy the the HDL Platfrom <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> with the RCC Platform <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> to create SD-Card artifacts for the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> device.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">deploy</span> <span class="pre">platform</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">zrf8_48dr</span></code></p>
</section>
<section id="populate-the-sd-card-artifacts-for-cp">
<span id="dev-populate-the-sd-card-artifacts-for-cp"></span><h3>Populate the SD-Card Artifacts for CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To populate the SD-Card Artifacts from the Control-Plane implementation onto a properly formatted SD-Card</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>Be sure that the <a class="reference internal" href="#dev-format-sd-card"><span class="std std-ref">Format SD card</span></a> section is complete.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/cdk/zrf8_48dr/sdcard-xilinx21_1_aarch64/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">/run/media/&lt;user&gt;/BOOT/*</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">BOOT.BIN</span> <span class="pre">boot.scr</span> <span class="pre">Image</span> <span class="pre">rootfs.cpio.gz.u-boot</span> <span class="pre">/run/media/&lt;user&gt;/BOOT/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-RLp</span> <span class="pre">opencpi/</span> <span class="pre">/run/media/&lt;user&gt;/BOOT/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">umount</span> <span class="pre">/dev/sda1</span></code></p>
</section>
<section id="hdl-cp-verification-opencpi-magic-word">
<span id="dev-hdl-cp-verification-opencpi-magic-word"></span><h3>HDL CP Verification: OpenCPI Magic Word</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Magic</span> <span class="pre">Word</span></code> is a constant value that is located in the OpenCPI Scalable Control Plane infrastructure HDL module and spells out <code class="docutils literal notranslate"><span class="pre">OPENCPIx</span></code> in hexidecimal. Successfully reading this register value is the first verification step to determine if the OpenCPI HDL Control Plane is functioning correctly.</p></li>
<li><p>As this step only requires devmem/devmem2 to be available on the embedded image, it does not require that the OpenCPI run-time utilities to have been cross-compiled, thus greatly simplifying the level of effort required for verification.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Perform the <a class="reference internal" href="#dev-booting-the-zrf8-48dr"><span class="std std-ref">Booting the zrf8_48dr</span></a> section in the Appendix to setup the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> device.</p></li>
<li><p>Perform the following commands to verify that the Control Plane is successfully enabled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">devmem</span> <span class="mh">0xa8000000</span>
<span class="mh">0x4F70656E</span>
<span class="o">%</span> <span class="n">devmem</span> <span class="mh">0xa8000004</span>
<span class="mh">0x43504900</span>
<span class="o">%</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">0x4F70656E</span></code> = Open</p>
<p><code class="docutils literal notranslate"><span class="pre">0x43504900</span></code> = CPIx</p>
</li>
</ol>
</section>
<section id="hdl-cp-verification-pattern-capture-application">
<span id="dev-hdl-cp-verification-pattern-capture-application"></span><h3>HDL CP Verification: Pattern Capture application</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Setup the zrf8_48dr with the OpenCPI runtime environment and run the <code class="docutils literal notranslate"><span class="pre">canary</span></code> Control Plane test
application <code class="docutils literal notranslate"><span class="pre">pattern_capture</span></code></p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Perform the <a class="reference internal" href="#dev-booting-the-zrf8-48dr"><span class="std std-ref">Booting the zrf8_48dr</span></a> section in the Appendix to setup the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> device.</p></li>
<li><p>During the next step (Execute the Standalone Mode setup section) implement the <code class="docutils literal notranslate"><span class="pre">mysetup.sh</span></code> script to target the <code class="docutils literal notranslate"><span class="pre">pattern_capture_asm</span></code> bitstream, rather than the <code class="docutils literal notranslate"><span class="pre">testbias</span></code> bitream.</p>
<p>FROM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo Loading bitstream
  if   ocpihdl load -d $OCPI_DEFAULT_HDL_DEVICE $OCPI_CDK_DIR/artifacts/testbias_$HDL_PLATFORM\_base.bitz; then
    echo Bitstream loaded successfully
</pre></div>
</div>
<p>TO:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo Loading bitstream
  if   ocpihdl load -d $OCPI_DEFAULT_HDL_DEVICE $OCPI_CDK_DIR/artifacts/pattern_capture_asm_$HDL_PLATFORM\_base.bitz; then
    echo Bitstream loaded successfully
</pre></div>
</div>
</li>
<li><p>Execute the <a class="reference internal" href="#dev-standalone-mode-setup"><span class="std std-ref">Standalone Mode setup</span></a> section.</p></li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">pattern_capture.xml</span></code> application</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>cd /home/root/opencpi/applications/</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpirun</span> <span class="pre">-v</span> <span class="pre">-x</span> <span class="pre">-d</span> <span class="pre">pattern_capture.xml</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ocpirun</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">d</span> <span class="n">pattern_capture</span><span class="o">.</span><span class="n">xml</span>
<span class="n">Available</span> <span class="n">containers</span> <span class="n">are</span><span class="p">:</span>  <span class="mi">0</span><span class="p">:</span> <span class="n">PL</span><span class="p">:</span><span class="mi">0</span> <span class="p">[</span><span class="n">model</span><span class="p">:</span> <span class="n">hdl</span> <span class="n">os</span><span class="p">:</span>  <span class="n">platform</span><span class="p">:</span> <span class="n">zrf8_48dr</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="n">rcc0</span> <span class="p">[</span><span class="n">model</span><span class="p">:</span> <span class="n">rcc</span> <span class="n">os</span><span class="p">:</span> <span class="n">linux</span> <span class="n">platform</span><span class="p">:</span> <span class="n">xilinx21_1_aarch64</span><span class="p">]</span>
<span class="n">Actual</span> <span class="n">deployment</span> <span class="ow">is</span><span class="p">:</span>
  <span class="n">Instance</span>  <span class="mi">0</span> <span class="n">pattern_v2</span> <span class="p">(</span><span class="n">spec</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">util_comps</span><span class="o">.</span><span class="n">pattern_v2</span><span class="p">)</span> <span class="n">on</span> <span class="n">hdl</span> <span class="n">container</span> <span class="mi">0</span><span class="p">:</span> <span class="n">PL</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">using</span> <span class="n">pattern_v2</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">pattern_v2</span> <span class="ow">in</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">pattern_capture_asm_zrf8_48dr_base</span><span class="o">.</span><span class="n">bitz</span> <span class="n">dated</span> <span class="n">Tue</span> <span class="n">Jan</span> <span class="mi">31</span> <span class="mi">11</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">20</span> <span class="mi">2023</span>
  <span class="n">Instance</span>  <span class="mi">1</span> <span class="n">capture_v2</span> <span class="p">(</span><span class="n">spec</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">util_comps</span><span class="o">.</span><span class="n">capture_v2</span><span class="p">)</span> <span class="n">on</span> <span class="n">hdl</span> <span class="n">container</span> <span class="mi">0</span><span class="p">:</span> <span class="n">PL</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">using</span> <span class="n">capture_v2</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">capture_v2</span> <span class="ow">in</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">pattern_capture_asm_zrf8_48dr_base</span><span class="o">.</span><span class="n">bitz</span> <span class="n">dated</span> <span class="n">Tue</span> <span class="n">Jan</span> <span class="mi">31</span> <span class="mi">11</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">20</span> <span class="mi">2023</span>
<span class="n">Application</span> <span class="n">XML</span> <span class="n">parsed</span> <span class="ow">and</span> <span class="n">deployments</span> <span class="p">(</span><span class="n">containers</span> <span class="ow">and</span> <span class="n">artifacts</span><span class="p">)</span> <span class="n">chosen</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">53</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Application</span> <span class="n">established</span><span class="p">:</span> <span class="n">containers</span><span class="p">,</span> <span class="n">workers</span><span class="p">,</span> <span class="n">connections</span> <span class="nb">all</span> <span class="n">created</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">3</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">initial</span> <span class="nb">property</span> <span class="n">values</span><span class="p">:</span>
<span class="n">Property</span>   <span class="mi">0</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">dataRepeat</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">1</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">numMessagesMax</span> <span class="o">=</span> <span class="s2">&quot;0x5&quot;</span> <span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">2</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">messagesToSend</span> <span class="o">=</span> <span class="s2">&quot;0x5&quot;</span>
<span class="n">Property</span>   <span class="mi">3</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">messagesSent</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>   <span class="mi">4</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">dataSent</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>   <span class="mi">5</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">numDataWords</span> <span class="o">=</span> <span class="s2">&quot;0xf&quot;</span> <span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">6</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">numMessageFields</span> <span class="o">=</span> <span class="s2">&quot;0x2&quot;</span> <span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">7</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="s2">&quot;{0x4,0xfb},{0x8,0xfc},{0xc,0xfd},{0x10,0xfe},{0x14,0xff}&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">8</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">20</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopOnFull</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">21</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">metadataCount</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>  <span class="mi">22</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">dataCount</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>  <span class="mi">23</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">numRecords</span> <span class="o">=</span> <span class="s2">&quot;0x100&quot;</span> <span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">24</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">numDataWords</span> <span class="o">=</span> <span class="s2">&quot;0x400&quot;</span> <span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">25</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">numMetadataWords</span> <span class="o">=</span> <span class="s2">&quot;0x4&quot;</span> <span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">26</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">metaFull</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">27</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">dataFull</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">28</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopZLMOpcode</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">29</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopOnZLM</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">30</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopOnEOF</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">31</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">totalBytes</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>  <span class="mi">32</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0x0}</span><span class="s2">&quot;</span>
<span class="n">Property</span>  <span class="mi">33</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Application</span> <span class="n">started</span><span class="o">/</span><span class="n">running</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">6</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">application</span> <span class="n">to</span> <span class="n">finish</span> <span class="p">(</span><span class="n">no</span> <span class="n">time</span> <span class="n">limit</span><span class="p">)</span>
<span class="n">Application</span> <span class="n">finished</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">0</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">final</span> <span class="nb">property</span> <span class="n">values</span><span class="p">:</span>
<span class="n">Property</span>   <span class="mi">0</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">dataRepeat</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">2</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">messagesToSend</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>   <span class="mi">3</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">messagesSent</span> <span class="o">=</span> <span class="s2">&quot;0x5&quot;</span>
<span class="n">Property</span>   <span class="mi">4</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">dataSent</span> <span class="o">=</span> <span class="s2">&quot;0xf&quot;</span>
<span class="n">Property</span>   <span class="mi">7</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="s2">&quot;{0x4,0xfb},{0x8,0xfc},{0xc,0xfd},{0x10,0xfe},{0x14,0xff}&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">8</span><span class="p">:</span> <span class="n">pattern_v2</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">20</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopOnFull</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">21</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">metadataCount</span> <span class="o">=</span> <span class="s2">&quot;0x5&quot;</span>
<span class="n">Property</span>  <span class="mi">22</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">dataCount</span> <span class="o">=</span> <span class="s2">&quot;0xf&quot;</span>
<span class="n">Property</span>  <span class="mi">26</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">metaFull</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">27</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">dataFull</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">28</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopZLMOpcode</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">29</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopOnZLM</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">30</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">stopOnEOF</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">31</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">totalBytes</span> <span class="o">=</span> <span class="s2">&quot;0x3c&quot;</span>
<span class="n">Property</span>  <span class="mi">32</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;{0xfb000004,0xc6abce0,0xc6abce0,0x25b},{0xfc000008,0xc6abdb7,0xc6abdb7,0x25b},{0xfd00000c,0xc6abe8e,0xc6abdb7,0x25b},{0xfe000010,0xc6abf64,0xc6abe8e,0x25b},{0xff000014,0xc6ac03b,0xc6abf64,0x25b},</span><span class="si">{0x0}</span><span class="s2">&quot;</span>
<span class="n">Property</span>  <span class="mi">33</span><span class="p">:</span> <span class="n">capture_v2</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;0x0,0x0,0x1,0x0,0x1,0x2,0x0,0x1,0x2,0x3,0x0,0x1,0x2,0x3,0x4,0x0&quot;</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="enable-opencpi-hdl-data-plane">
<span id="dev-enable-opencpi-hdl-data-plane"></span><h2>Enable OpenCPI HDL Data Plane</h2>
<section id="configure-ps-for-dp">
<span id="dev-configure-ps-for-dp"></span><h3>Configure PS for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Modify the PS core IP from the <a class="reference internal" href="#dev-configure-ps-for-cp"><span class="std std-ref">Configure PS for CP</span></a> section, to add the ports necessary to support enabling the OpenCPI Data Plane</p></li>
<li><p>Re-generate the PS core IP output products</p></li>
<li><p>Build, Run/Verify the <code class="docutils literal notranslate"><span class="pre">canary</span></code> Data Plane application: <code class="docutils literal notranslate"><span class="pre">testbias</span></code></p></li>
<li><p>Build, Run/Verify another application which requires the Data Plane, but is more complicated: FSK <code class="docutils literal notranslate"><span class="pre">filerw</span></code></p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>These steps continue with the completion of the <a class="reference internal" href="#dev-configure-ps-for-cp"><span class="std std-ref">Configure PS for CP</span></a> section.</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/Xilinx/Vivado/2021.1/settings64.sh</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">zrf8_48dr_cp/</span>&#160; <span class="pre">zrf8_48dr_dp/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">zrf8_48dr_dp/pl_core/build/htg-zrf8-rev3/pl_core/</span></code></p>
</li>
<li><p>Remove the old <code class="docutils literal notranslate"><span class="pre">petalinux_cp</span></code> directory</p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">petalinux_cp</span></code></p>
</li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">pl_core</span></code> project</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/Xilinx/Vivado/2021.1/settings64.sh</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">vivado</span> <span class="pre">pl_core.xpr</span> <span class="pre">&amp;</span></code></p>
</li>
<li><p>Enable the Slave High Performance ports of the PS core IP</p>
<ol class="arabic simple">
<li><p>Open the Block Design</p></li>
<li><p>Double-click the <code class="docutils literal notranslate"><span class="pre">zynq_ultra_ps_e_0</span></code> IP Block</p></li>
<li><p>Click on the PS-PL Configuration</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PS-PL</span> <span class="pre">Interface</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Slave</span> <span class="pre">Interface</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP</span></code> -&gt; Enable the following AXI HP Ports: <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP0</span> <span class="pre">FPD</span></code>, <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP1</span> <span class="pre">FPD</span></code>, <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP2</span> <span class="pre">FPD</span></code>, <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP3</span> <span class="pre">FPD</span></code></p></li>
<li><p>From the same location expand each of the enabled <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP*</span> <span class="pre">FPD</span></code> Ports to select a <code class="docutils literal notranslate"><span class="pre">64</span> <span class="pre">bit</span></code> <code class="docutils literal notranslate"><span class="pre">AXI</span> <span class="pre">HP</span> <span class="pre">FPD*</span> <span class="pre">Data</span> <span class="pre">Width</span></code> -&gt; Select <code class="docutils literal notranslate"><span class="pre">OK</span></code></p></li>
<li><p>For each of the Slave AXI HP port clocks ( <code class="docutils literal notranslate"><span class="pre">saxihp*_fpd_aclk</span></code>), perform <code class="docutils literal notranslate"><span class="pre">Make</span> <span class="pre">External</span></code></p></li>
</ol>
</li>
</ol>
</li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Regenerate</span> <span class="pre">Layout</span></code></p></li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Validate</span> <span class="pre">Design</span> <span class="pre">(F6)</span></code></p></li>
<li><p>Perform <code class="docutils literal notranslate"><span class="pre">Flow</span> <span class="pre">Navigator</span> <span class="pre">window</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">INTEGRATOR</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">Block</span> <span class="pre">Design</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Generate</span></code></p></li>
<li><p>Export an <code class="docutils literal notranslate"><span class="pre">.xsa</span></code> file</p>
<ul class="simple">
<li><p>File -&gt; Export -&gt; Export Hardware…-&gt; Next -&gt; Pre-synthesis -&gt; Finish</p></li>
<li><p>Leave the default export location <code class="docutils literal notranslate"><span class="pre">pl_core</span></code></p></li>
<li><p>Overwrite the <code class="docutils literal notranslate"><span class="pre">*.xsa</span></code> that is there from the Control-Plane section</p></li>
</ul>
</li>
<li><p>The Block Design should look as follows:</p></li>
</ol>
<figure class="align-center" id="id8">
<img alt="ZRF8 PS DP Block Design" src="../../../../_images/zrf8_48dr_dp.png" />
<figcaption>
<p><span class="caption-number">Figure 2: </span><span class="caption-text">ZRF8 PS DP Block Design</span></p>
</figcaption>
</figure>
</section>
<section id="configure-hdl-primitive-for-dp">
<span id="dev-configure-hdl-primitive-for-dp"></span><h3>Configure HDL Primitive for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Edit the OpenCPI HDL primitive library source to support the Slave High-Performance (HP) ports that were made available in the previous section.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><strong>CODEBLOCK</strong>: The code block for the various files that make up the HDL Primitive can be found in the following directory of the ocpi.osp.hitech-global repository::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span><span class="o">/</span><span class="n">hdl</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">zrf8_48dr</span><span class="o">/</span><span class="n">guide</span><span class="o">/</span><span class="n">code</span><span class="o">-</span><span class="n">blocks</span><span class="o">/</span><span class="n">data</span><span class="o">-</span><span class="n">plane</span><span class="o">/</span><span class="n">primitives</span><span class="o">/</span>
</pre></div>
</div>
<ol class="arabic">
<li><p>At the start of this effort, perform a clean within the OSP directory to ensure that no stale files exist</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/osps/ocpi.osp.hitech-global</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">clean</span></code></p>
</li>
<li><p>In an effort to avoid stale content, remove the current PS core IP before copying over the updated version</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">ocpi.osp.hitech-global/hdl/primitives/zynq_ultra_zrf8_48dr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">design_1_zynq_ultra_ps_e_0_0</span></code></p>
</li>
<li><p>From <a class="reference internal" href="#dev-configure-ps-for-dp"><span class="std std-ref">Configure PS for DP</span></a>, copy the updated <code class="docutils literal notranslate"><span class="pre">design_1_zynq_ultra_ps_e_0_0</span></code> directory into the <code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global</span></code> HDL primitive directory</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_dp/pl_core/build/htg-zrf8-rev3/pl_core/pl_core.srcs/sources_1/bd/design_1/ip/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">design_1_zynq_ultra_ps_e_0_0/</span> <span class="pre">&lt;ocpi.osp.hitech-global&gt;/hdl/primitives/zynq_ultra_zrf8_48dr/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">&lt;ocpi.osp.hitech-global&gt;/hdl/primitives/zynq_ultra_zrf8_48dr</span></code></p>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_pkg.vhd</span></code> file to include the newly enabled Slave HP ports</p>
<ol class="arabic simple">
<li><p>In the entity, uncomment the <code class="docutils literal notranslate"><span class="pre">s_axi_hp_in</span></code> and <code class="docutils literal notranslate"><span class="pre">s_axi_hp_out</span></code> ports</p></li>
</ol>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">zynq_ultra_zrf8_48dr_ps.vhd</span></code> file to enable the newly enabled Slave HP ports</p>
<ol class="arabic simple">
<li><p>In the entity, uncomment the <code class="docutils literal notranslate"><span class="pre">s_axi_hp_in</span></code> and <code class="docutils literal notranslate"><span class="pre">s_axi_hp_out</span></code> ports</p></li>
<li><p>Uncomment all other ports which included:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">saxihp0_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp1_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxihp3_*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saxigp2_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp3_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp4_*</span></code>, <code class="docutils literal notranslate"><span class="pre">saxigp5_*</span></code></p></li>
</ol>
</li>
<li><p>Uncomment the <code class="docutils literal notranslate"><span class="pre">gs:</span> <span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">0</span> <span class="pre">to</span> <span class="pre">C_S_AXI_HP_COUNT-1</span> <span class="pre">generate</span></code> code block</p></li>
</ol>
</li>
</ol>
</section>
<section id="build-hdl-primitive-for-dp">
<span id="dev-build-hdl-primitive-dp"></span><h3>Build HDL Primitive for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Build the HDL Primitive that implements the DP and which is instanced in the zrf8_48dr HDL Platform
Worker</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Return to the top of the project</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/osps/ocpi.osp.hitech-global</span></code></p>
</li>
<li><p><strong>Build the primitive library</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">--hdl-target</span> <span class="pre">zynq_ultra</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ocpidev build --hdl-target zynq_ultra
No HDL platforms specified.  No HDL assets will be targeted.
Possible HdlPlatforms are: alst4 alst4x isim matchstiq_z1 ml605 modelsim x4sim xsim zcu104 zcu104 zcu104_ise.
make[1]: Entering directory `/home/user/opencpi/projects/osps/ocpi.osp.hitech-global&#39;
make[1]: Leaving directory `/home/user/opencpi/projects/osps/ocpi.osp.hitech-global&#39;
============== For library zynq_ultra_zrf8_48dr:
Building the zynq_ultra_zrf8_48dr library for zynq_ultra (target-zynq_ultra/zynq_ultra_zrf8_48dr) 0:()
 Tool &quot;vivado&quot; for target &quot;zynq_ultra&quot; succeeded.  0:00.02 at 14:13:29
Creating directory ../lib/zynq_ultra_zrf8_48dr for library zynq_ultra_zrf8_48dr
No previous installation for gen/zynq_ultra_zrf8_48dr.libs in ../lib/zynq_ultra_zrf8_48dr.
Installing gen/zynq_ultra_zrf8_48dr.libs into ../lib/zynq_ultra_zrf8_48dr
No previous installation for target-zynq_ultra/zynq_ultra_zrf8_48dr.sources in target-zynq_ultra/zynq_ultra_zrf8_48dr.
Installing target-zynq_ultra/zynq_ultra_zrf8_48dr.sources into target-zynq_ultra/zynq_ultra_zrf8_48dr
No previous installation for target-zynq_ultra/zynq_ultra_zrf8_48dr in ../lib/zynq_ultra_zrf8_48dr/zynq_ultra.
Installing target-zynq_ultra/zynq_ultra_zrf8_48dr into ../lib/zynq_ultra_zrf8_48dr/zynq_ultra
</pre></div>
</div>
</li>
</ol>
</section>
<section id="configure-hdl-platform-worker-for-dp">
<span id="dev-configure-hdl-platform-worker-for-dp"></span><h3>Configure HDL Platform Worker for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Edit the HDL Platform Worker files in order to implement the Slave High-Performance (HP) ports that have been made available to the ZynqMP Processing System.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><strong>CODEBLOCK</strong>: The code block for the various files that make up the HDL Primitive can be found in the following directory of the ocpi.osp.hitech-global repository::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ocpi</span><span class="o">.</span><span class="n">osp</span><span class="o">.</span><span class="n">hitech</span><span class="o">-</span><span class="k">global</span><span class="o">/</span><span class="n">hdl</span><span class="o">/</span><span class="n">platforms</span><span class="o">/</span><span class="n">zrf8_48dr</span><span class="o">/</span><span class="n">guide</span><span class="o">/</span><span class="n">code</span><span class="o">-</span><span class="n">blocks</span><span class="o">/</span><span class="n">data</span><span class="o">-</span><span class="n">plane</span><span class="o">/</span><span class="n">platforms</span><span class="o">/</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.xml</span></code> file</p>
<ol class="arabic simple">
<li><p>Uncomment the <code class="docutils literal notranslate"><span class="pre">&lt;sdp</span> <span class="pre">name='zynq_ultra'</span> <span class="pre">master='true'</span> <span class="pre">count='4'/&gt;</span></code></p></li>
<li><p>Uncomment the following Properties: <code class="docutils literal notranslate"><span class="pre">axi_error</span></code>, and <code class="docutils literal notranslate"><span class="pre">sdpDropCount</span></code></p></li>
<li><p>Leave the <code class="docutils literal notranslate"><span class="pre">debug_state*</span></code> properties commented out</p></li>
</ol>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr.vhd</span></code> file:</p>
<ol class="arabic simple">
<li><p>Uncomment the <code class="docutils literal notranslate"><span class="pre">library</span> <span class="pre">sdp</span></code></p></li>
<li><p>Uncomment the newly created <code class="docutils literal notranslate"><span class="pre">Slave</span> <span class="pre">HP</span></code> signals: <code class="docutils literal notranslate"><span class="pre">ps_m_axi_gp_in</span></code>, and <code class="docutils literal notranslate"><span class="pre">ps_m_axi_gp_out</span></code></p></li>
<li><p>Uncomment the sdp signals: <code class="docutils literal notranslate"><span class="pre">my_sdp_out</span></code>, and <code class="docutils literal notranslate"><span class="pre">my_sdp_out_data</span></code></p></li>
<li><p>Leave the <code class="docutils literal notranslate"><span class="pre">dbg_state*</span></code> signals commented out</p></li>
<li><p>Uncomment the <code class="docutils literal notranslate"><span class="pre">s_axi_hp_in</span></code> and <code class="docutils literal notranslate"><span class="pre">s_axi_hp_out</span></code> signals in the <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">:</span> <span class="pre">zynq_ultra_zrf8_48dr_ps</span></code>
code block</p></li>
<li><p>Uncomment the <code class="docutils literal notranslate"><span class="pre">zynq_ultra_out</span></code> and <code class="docutils literal notranslate"><span class="pre">zynq_ultra_out_data</span></code> signals in the <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">:</span> <span class="pre">axi_...</span></code>
code block</p></li>
<li><p>Uncomment the generate block for the <code class="docutils literal notranslate"><span class="pre">sdp2axi</span> <span class="pre">adapter</span></code>, leave the <code class="docutils literal notranslate"><span class="pre">dbg_state*</span></code> signals
commented out</p></li>
</ol>
</li>
</ol>
</section>
<section id="build-hdl-platform-worker-for-dp">
<span id="dev-build-hdl-platform-worker-for-dp"></span><h3>Build HDL Platform Worker for DP</h3>
<ol class="arabic">
<li><p><strong>Build the HDL Platform Worker and “base” Platform Configuration</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/projects/osps/ocpi.osp.hitech-global</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">--hdl-platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--rcc-platform</span> <span class="pre">xilinx21_1_aarch64</span></code></p>
</li>
</ol>
</section>
<section id="undo-edits-made-to-validate-hdl-cp">
<span id="dev-undo-edits-made-to-validate-hdl-cp"></span><h3>Undo edits made to validate HDL CP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>Initially in support of validating the HDL platform for Control Plane ONLY, several scripts
were modified to build and deploy the <code class="docutils literal notranslate"><span class="pre">canary</span></code> Control Plane bitstream (pattern_capture). The
purpose of this section is to revert those changes such that the <code class="docutils literal notranslate"><span class="pre">canary</span></code> Data Plane bitstream
(testbias) will be installed (i.e. built) and deployed for the targeted HDL platform.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">tools/scripts/deploy-platform.sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">tools/scripts/export-platform-to-framework.sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">tools/scripts/ocpiadmin.sh</span></code></p></li>
</ol>
</section>
<section id="install-the-hdl-platform-zrf8-48dr-for-dp">
<span id="dev-install-the-hdl-platform-zrf8-48dr-for-dp"></span><h3>Install the HDL Platform zrf8_48dr for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The goal of this section is to <strong>install</strong> the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> HDL Platform.</p></li>
<li><p>Installation of the <code class="docutils literal notranslate"><span class="pre">ZRF8</span></code> includes building the HDL Container (i.e. bitstream) for verifying
the Control Plane.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>With all previous <a class="reference internal" href="#dev-enable-opencpi-hdl-data-plane"><span class="std std-ref">Enable OpenCPI HDL Data Plane</span></a> sections complete, the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> HDL and <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code>  RCC platform can now be installed and deployed.</p>
<ol class="arabic">
<li><p>Browse to top of the OpenCPI directory</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
</li>
<li><p>Setup terminal for OpenCPI development</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">./cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_XILINX_VIVADO_VERSION=2021.1</span></code></p>
</li>
<li><p><strong>Install: zrf8_48dr (an HDL platform)</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">install</span> <span class="pre">platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--minimal</span></code></p>
</li>
</ol>
</section>
<section id="petalinux-workspace-for-dp">
<span id="dev-petalinux-workspace-for-dp"></span><h3>Petalinux workspace for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The following <a class="reference external" href="https://docs.xilinx.com/r/2021.1-English/ug1144-petalinux-tools-reference-guide">Petalinux Tools Documentation Reference Guide (UG1144)</a> describes the commands and build flow that will be utilized in this section. These steps can be revisted, and will allow consequent bitstreams to be “spot checked”.</p></li>
<li><p>Successful completion of this section is a bootable SD-card image utilizing the Petalinux utility</p></li>
</ul>
<p>TODO: Include Integrating buildtools-extended into Petalinux picture for GCC Error</p>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Source Petalinux 2021.1</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/Xilinx/Petalinux/2021.1/settings.sh</span></code></p>
</li>
<li><p>Create a petalinux project directory for Control-Plane (cp)</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_dp/pl_core/build/htg-zrf8-rev3/pl_core/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-create</span> <span class="pre">-t</span> <span class="pre">project</span> <span class="pre">--template</span> <span class="pre">zynqMP</span> <span class="pre">--name</span> <span class="pre">&quot;petalinux_dp&quot;</span></code></p>
</li>
<li><p><strong>Be sure that the</strong> <a class="reference internal" href="#dev-petalinux-fix-for-zrf8"><span class="std std-ref">Petalinux Fix for ZRF8</span></a> <strong>section was completed.</strong></p></li>
<li><p>Import the Hardware Configuration that was exported from the Vivado project. This is the <code class="docutils literal notranslate"><span class="pre">*.xsa</span></code> file that was created during the  File → Export → Export Hardware step.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_dp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_dp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-config</span> <span class="pre">--get-hw-description=../</span></code></p>
</li>
<li><p>Once the <code class="docutils literal notranslate"><span class="pre">/misc/config</span></code> System Configuration GUI is present in the terminal, continue with the following edits</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">Yocto</span> <span class="pre">Settings</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">[*]</span> <span class="pre">Enable</span> <span class="pre">Buildtools</span> <span class="pre">Extended</span></code></p></li>
<li><p>Exit -&gt; Yes</p></li>
<li><p>If you are presented with: <code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">generate</span> <span class="pre">meta-plnx-generated</span> <span class="pre">layer</span></code>, this can be fixed with the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">sysctl</span> <span class="pre">-n</span> <span class="pre">-w</span> <span class="pre">fs.inotify.max_user_watches=524288</span></code></p>
</li>
</ol>
</li>
<li><p>Build the project <strong>You may need to run ``petalinux-build`` twice to get passed some erroneous errors</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-build</span></code></p>
</li>
<li><p>Package the <code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code> image</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">images/linux</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">petalinux-package</span> <span class="pre">--boot</span> <span class="pre">--fsbl</span> <span class="pre">--u-boot</span> <span class="pre">--force</span></code></p>
<p>There should now be a <code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code> in the <code class="docutils literal notranslate"><span class="pre">images/linux</span></code> directory</p>
</li>
</ol>
</section>
<section id="create-dp-boot-artifacts">
<h3>Create DP Boot Artifacts</h3>
<p><strong>GOAL:</strong></p>
<p>Create Control-Plane boot artifacts for the framework to leverage when the Platform is deployed</p>
<p><strong>IMPLEMENTATION</strong></p>
<ol class="arabic">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">2021.1-zrf8_48dr-release</span></code> directory to store boot artifacts</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_dp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_dp/images/linux</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">2021.1-zrf8_48dr-release</span></code></p>
</li>
<li><p>Copy the boot artifacts into the directory and create a <code class="docutils literal notranslate"><span class="pre">ZynqReleases</span></code> tar</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">BOOT.BIN</span> <span class="pre">image.ub</span> <span class="pre">boot.scr</span> <span class="pre">2021.1-zrf8_48dr-release</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">cvfz</span> <span class="pre">2021.1-zrf8_48dr-release.tar.xz</span> <span class="pre">2021.1-zrf8_48dr-release</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">2021.1-zrf8_48dr-release.tar.xz</span> <span class="pre">/opt/Xilinx/ZynqReleases/2021.1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">&lt;user&gt;:users</span> <span class="pre">/opt/Xilinx/ZynqReleases/2021.1</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">smith:users</span> <span class="pre">/opt/Xilinx/ZynqReleases</span></code></p></li>
<li><p>Note: This may require adjusting the permissions for <code class="docutils literal notranslate"><span class="pre">/opt/Xilinx/ZynqReleases</span></code> or its subdirectories</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="install-the-rcc-platform-xilinx21-1-aarch64-for-dp">
<span id="dev-install-the-rcc-platform-xilinx21-1-aarch64-for-dp"></span><h3>Install the RCC Platform xilinx21_1_aarch64 for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The goal of this section is to <strong>install</strong> the <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> RCC Platform</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Browse to top of the OpenCPI directory</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
</li>
<li><p>Setup terminal for OpenCPI development</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">./cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_XILINX_VIVADO_VERSION=2021.1</span></code></p>
</li>
<li><p><strong>Reinstall RCC Platform</strong> <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> so that the new <code class="docutils literal notranslate"><span class="pre">2021.1-zrf8_48dr-release.tar.xz</span></code> boot artifacts can be implemented into the framework.</p>
<ol class="arabic">
<li><p>Remove the old <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> from <code class="docutils literal notranslate"><span class="pre">cdk</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/cdk</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">xilinx21_1_aarch64</span></code></p>
</li>
<li><p>Clean out stale build artifacts from <code class="docutils literal notranslate"><span class="pre">core/rcc/platforms/xilinx21_1_aarch64</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core/rcc/platforms/xilinx21_1_aarch64</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">gen/</span> <span class="pre">lib/</span></code></p>
</li>
<li><p>Unregister/Re-register project</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">unregister</span> <span class="pre">project</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpidev</span> <span class="pre">register</span> <span class="pre">project</span></code></p>
</li>
<li><p>Reinstall the RCC platform</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">install</span> <span class="pre">platform</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">--minimal</span></code></p>
</li>
</ol>
</li>
</ol>
</section>
<section id="deploy-the-platforms-for-dp">
<span id="dev-deploy-the-platforms-for-dp"></span><h3>Deploy the Platforms for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To deploy the the HDL Platfrom <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> with the RCC Platform <code class="docutils literal notranslate"><span class="pre">xilinx21_1_aarch64</span></code> to create SD-Card artifacts for the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> device.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiadmin</span> <span class="pre">deploy</span> <span class="pre">platform</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">zrf8_48dr</span></code></p>
</section>
<section id="populate-the-sd-card-artifacts-for-dp">
<span id="dev-populate-the-sd-card-artifacts-for-dp"></span><h3>Populate the SD-Card Artifacts for DP</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To populate the SD-Card Artifacts from the Control-Plane implementation onto a properly formatted SD-Card</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>Be sure that the <a class="reference internal" href="#dev-format-sd-card"><span class="std std-ref">Format SD card</span></a> section is complete.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/cdk/zrf8_48dr/sdcard-xilinx21_1_aarch64/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">/run/media/&lt;user&gt;/BOOT/*</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">BOOT.BIN</span> <span class="pre">boot.scr</span> <span class="pre">Image</span> <span class="pre">rootfs.cpio.gz.u-boot</span> <span class="pre">/run/media/&lt;user&gt;/BOOT/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-RLp</span> <span class="pre">opencpi/</span> <span class="pre">/run/media/&lt;user&gt;/BOOT/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">umount</span> <span class="pre">/dev/sda1</span></code></p>
</section>
<section id="hdl-dp-verification-testbias-application">
<span id="dev-hdl-dp-verification-testbias-application"></span><h3>HDL DP Verification: testbias application</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To successfully execute the <code class="docutils literal notranslate"><span class="pre">canary</span></code> HDL Data Plane application on the embedded platform. <code class="docutils literal notranslate"><span class="pre">Success</span></code> is defined as the application ran to completion and the md5sum of the input data vs the output data of the testbias application match, when no bias is applied to the data, i.e. bias worker property biasValue=0.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>The</strong> <a class="reference internal" href="#dev-component-unit-test-results-table"><span class="std std-ref">Component Unit Test results table</span></a> <strong>section in the APPENDIX contains the verfication test results of the zrf8_48dr board.</strong></p>
</div>
<p><strong>IMPLEMENTATION:</strong></p>
<ol class="arabic">
<li><p>Be sure that the <span class="xref std std-ref">dev-Install-and-Deploy-with-DP-enabled</span> section has been implemented, specifically the <strong>Populate the sd-card artifacts</strong> step.</p></li>
<li><p>Execute the <a class="reference internal" href="#dev-standalone-mode-setup"><span class="std std-ref">Standalone Mode setup</span></a> section.</p></li>
<li><p>Run DP application: <code class="docutils literal notranslate"><span class="pre">testbias</span></code></p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">cd</span> <span class="pre">/home/root/opencpi/applications</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">export</span> <span class="pre">OCPI_LIBRARY_PATH=../artifacts:../xilinx21_1_aarch64/artifacts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">export</span> <span class="pre">OCPI_DMA_CACHE_MODE=0</span></code> (required if FOSS version is &lt;v2.4.3)</p></li>
<li><p>Confirm that the <code class="docutils literal notranslate"><span class="pre">testbias</span></code> application functions as expected by verify the input and
output are equal when assigning a testbias of zero 0 (no change).</p>
<p><code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">ocpirun</span> <span class="pre">-v</span> <span class="pre">-d</span> <span class="pre">-x</span> <span class="pre">-m</span> <span class="pre">bias=hdl</span> <span class="pre">-p</span> <span class="pre">bias=biasvalue=0</span> <span class="pre">testbias.xml</span></code></p>
<p>stdout of screen session:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/</span><span class="n">applications</span><span class="o">/</span>
<span class="o">%</span> <span class="n">export</span> <span class="n">OCPI_LIBRARY_PATH</span><span class="o">=../</span><span class="n">artifacts</span><span class="o">/</span><span class="p">:</span><span class="o">../</span><span class="n">xilinx21_1_aarch64</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span>
<span class="o">%</span> <span class="n">export</span> <span class="n">OCPI_DMA_CACHE_MODE</span><span class="o">=</span><span class="mi">0</span>
<span class="o">%</span> <span class="n">ocpirun</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">m</span> <span class="n">bias</span><span class="o">=</span><span class="n">hdl</span> <span class="o">-</span><span class="n">p</span> <span class="n">bias</span><span class="o">=</span><span class="n">biasvalue</span><span class="o">=</span><span class="mi">0</span><span class="o">^</span><span class="n">C</span>
<span class="o">%</span> <span class="n">ocpirun</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">m</span> <span class="n">bias</span><span class="o">=</span><span class="n">hdl</span> <span class="o">-</span><span class="n">p</span> <span class="n">bias</span><span class="o">=</span><span class="n">biasvalue</span><span class="o">=</span><span class="mi">0</span> <span class="n">testbias</span><span class="o">.</span><span class="n">xml</span>
<span class="n">Available</span> <span class="n">containers</span> <span class="n">are</span><span class="p">:</span>  <span class="mi">0</span><span class="p">:</span> <span class="n">PL</span><span class="p">:</span><span class="mi">0</span> <span class="p">[</span><span class="n">model</span><span class="p">:</span> <span class="n">hdl</span> <span class="n">os</span><span class="p">:</span>  <span class="n">platform</span><span class="p">:</span> <span class="n">zrf8_48dr</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="n">rcc0</span> <span class="p">[</span><span class="n">model</span><span class="p">:</span> <span class="n">rcc</span> <span class="n">os</span><span class="p">:</span> <span class="n">linux</span> <span class="n">platform</span><span class="p">:</span> <span class="n">xilinx21_1_aarch64</span><span class="p">]</span>
<span class="n">Actual</span> <span class="n">deployment</span> <span class="ow">is</span><span class="p">:</span>
  <span class="n">Instance</span>  <span class="mi">0</span> <span class="n">file_read</span> <span class="p">(</span><span class="n">spec</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">file_read</span><span class="p">)</span> <span class="n">on</span> <span class="n">rcc</span> <span class="n">container</span> <span class="mi">1</span><span class="p">:</span> <span class="n">rcc0</span><span class="p">,</span> <span class="n">using</span> <span class="n">file_read</span> <span class="ow">in</span> <span class="o">../</span><span class="n">xilinx21_1_aarch64</span><span class="o">/</span><span class="n">artifacts</span><span class="o">//</span><span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">file_read</span><span class="o">.</span><span class="n">rcc</span><span class="mf">.0</span><span class="o">.</span><span class="n">xilinx21_1_aarch64</span><span class="o">.</span><span class="n">so</span> <span class="n">dated</span> <span class="n">Mon</span> <span class="n">Dec</span> <span class="mi">13</span> <span class="mi">19</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">08</span> <span class="mi">2021</span>
  <span class="n">Instance</span>  <span class="mi">1</span> <span class="n">bias</span> <span class="p">(</span><span class="n">spec</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="n">on</span> <span class="n">hdl</span> <span class="n">container</span> <span class="mi">0</span><span class="p">:</span> <span class="n">PL</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">using</span> <span class="n">bias_vhdl</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">bias_vhdl</span> <span class="ow">in</span> <span class="o">../</span><span class="n">artifacts</span><span class="o">//</span><span class="n">testbias_zrf8_48dr_base</span><span class="o">.</span><span class="n">bitz</span> <span class="n">dated</span> <span class="n">Mon</span> <span class="n">Dec</span> <span class="mi">13</span> <span class="mi">19</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">08</span> <span class="mi">2021</span>
  <span class="n">Instance</span>  <span class="mi">2</span> <span class="n">file_write</span> <span class="p">(</span><span class="n">spec</span> <span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">file_write</span><span class="p">)</span> <span class="n">on</span> <span class="n">rcc</span> <span class="n">container</span> <span class="mi">1</span><span class="p">:</span> <span class="n">rcc0</span><span class="p">,</span> <span class="n">using</span> <span class="n">file_write</span> <span class="ow">in</span> <span class="o">../</span><span class="n">xilinx21_1_aarch64</span><span class="o">/</span><span class="n">artifacts</span><span class="o">//</span><span class="n">ocpi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">file_write</span><span class="o">.</span><span class="n">rcc</span><span class="mf">.0</span><span class="o">.</span><span class="n">xilinx21_1_aarch64</span><span class="o">.</span><span class="n">so</span> <span class="n">dated</span> <span class="n">Mon</span> <span class="n">Dec</span> <span class="mi">13</span> <span class="mi">19</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">08</span> <span class="mi">2021</span>
<span class="n">Application</span> <span class="n">XML</span> <span class="n">parsed</span> <span class="ow">and</span> <span class="n">deployments</span> <span class="p">(</span><span class="n">containers</span> <span class="ow">and</span> <span class="n">artifacts</span><span class="p">)</span> <span class="n">chosen</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">40</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Application</span> <span class="n">established</span><span class="p">:</span> <span class="n">containers</span><span class="p">,</span> <span class="n">workers</span><span class="p">,</span> <span class="n">connections</span> <span class="nb">all</span> <span class="n">created</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">66</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">initial</span> <span class="nb">property</span> <span class="n">values</span><span class="p">:</span>
<span class="n">Property</span>   <span class="mi">0</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;test.input&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">1</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">messagesInFile</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">2</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">opcode</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">3</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">messageSize</span> <span class="o">=</span> <span class="s2">&quot;0x10&quot;</span>
<span class="n">Property</span>   <span class="mi">4</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">granularity</span> <span class="o">=</span> <span class="s2">&quot;0x4&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">5</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>   <span class="mi">6</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">bytesRead</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>   <span class="mi">7</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">messagesWritten</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>   <span class="mi">8</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">suppressEOF</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>   <span class="mi">9</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">badMessage</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">16</span><span class="p">:</span> <span class="n">bias</span><span class="o">.</span><span class="n">biasValue</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">20</span><span class="p">:</span> <span class="n">bias</span><span class="o">.</span><span class="n">test64</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>  <span class="mi">31</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;test.output&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">32</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">messagesInFile</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">33</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">bytesWritten</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>  <span class="mi">34</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">messagesWritten</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Property</span>  <span class="mi">35</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">stopOnEOF</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">39</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">suppressWrites</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">40</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">countData</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">41</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">bytesPerSecond</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
<span class="n">Application</span> <span class="n">started</span><span class="o">/</span><span class="n">running</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">1</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">application</span> <span class="n">to</span> <span class="n">finish</span> <span class="p">(</span><span class="n">no</span> <span class="n">time</span> <span class="n">limit</span><span class="p">)</span>
<span class="n">Application</span> <span class="n">finished</span> <span class="p">[</span><span class="mi">0</span> <span class="n">s</span> <span class="mi">20</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">final</span> <span class="nb">property</span> <span class="n">values</span><span class="p">:</span>
<span class="n">Property</span>   <span class="mi">0</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;test.input&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">1</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">messagesInFile</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">2</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">opcode</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">3</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">messageSize</span> <span class="o">=</span> <span class="s2">&quot;0x10&quot;</span>
<span class="n">Property</span>   <span class="mi">4</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">granularity</span> <span class="o">=</span> <span class="s2">&quot;0x4&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">5</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">6</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">bytesRead</span> <span class="o">=</span> <span class="s2">&quot;0xfa0&quot;</span>
<span class="n">Property</span>   <span class="mi">7</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">messagesWritten</span> <span class="o">=</span> <span class="s2">&quot;0xfa&quot;</span>
<span class="n">Property</span>   <span class="mi">8</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">suppressEOF</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>   <span class="mi">9</span><span class="p">:</span> <span class="n">file_read</span><span class="o">.</span><span class="n">badMessage</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">Property</span>  <span class="mi">16</span><span class="p">:</span> <span class="n">bias</span><span class="o">.</span><span class="n">biasValue</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">20</span><span class="p">:</span> <span class="n">bias</span><span class="o">.</span><span class="n">test64</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">31</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;test.output&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">32</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">messagesInFile</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">33</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">bytesWritten</span> <span class="o">=</span> <span class="s2">&quot;0xfa0&quot;</span>
<span class="n">Property</span>  <span class="mi">34</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">messagesWritten</span> <span class="o">=</span> <span class="s2">&quot;0xfb&quot;</span>
<span class="n">Property</span>  <span class="mi">35</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">stopOnEOF</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">39</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">suppressWrites</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">40</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">countData</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="p">(</span><span class="n">cached</span><span class="p">)</span>
<span class="n">Property</span>  <span class="mi">41</span><span class="p">:</span> <span class="n">file_write</span><span class="o">.</span><span class="n">bytesPerSecond</span> <span class="o">=</span> <span class="s2">&quot;0x44229&quot;</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Verify that the data has successfully transferred through the application by performing an
m5sum on the input and output data files with bias effectively disabled, by setting the
biasValue=0.</p>
<p>Compare the md5sum of both <code class="docutils literal notranslate"><span class="pre">test.input</span></code> and <code class="docutils literal notranslate"><span class="pre">test.output</span></code>. The stdout should be as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">md5sum</span> <span class="n">test</span><span class="o">.*</span>
<span class="mf">2934e1</span><span class="n">a7ae11b11b88c9b0e520efd978</span>  <span class="n">test</span><span class="o">.</span><span class="n">input</span>
<span class="mf">2934e1</span><span class="n">a7ae11b11b88c9b0e520efd978</span>  <span class="n">test</span><span class="o">.</span><span class="n">output</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>This shows that with a biasvalue=0 (no change in data) that the input matches the output
and the testbias application is working as it should.</strong></p>
</div>
</section>
</section>
<section id="component-unit-testing">
<span id="dev-component-unit-testing"></span><h2>Component Unit Testing</h2>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To build, run and capture the results for each of the Component Unit Tests provided with the OpenCPI framework. The <code class="docutils literal notranslate"><span class="pre">PASS</span></code> (P) or <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> (F), results for each test are captured in the <a class="reference internal" href="#dev-component-unit-test-results-table"><span class="std std-ref">Component Unit Test results table</span></a> section. The table compares the <code class="docutils literal notranslate"><span class="pre">PASS</span> <span class="pre">and</span> <span class="pre">FAIL</span></code> results to the FOSS supported zcu104. Refer to this table to ensure that testing behavior is consistent.</p></li>
</ul>
<section id="build-the-unit-tests-in-parallel-on-the-development-host">
<span id="dev-build-the-unit-tests-in-parallel-on-the-development-host"></span><h3>Build the Unit Tests (in parallel) on the Development Host</h3>
<p>This process can be done in parallel. Open three different terminals and build all three Unit Test project directories (core, assets, assets_ts).</p>
<ol class="arabic">
<li><p>Build the component unit tests from project: <strong>core</strong> (Takes several hours)</p>
<p>Open a new terminal on your local machine</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <span class="pre">cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core/components</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">tests</span> <span class="pre">--hdl-platform</span> <span class="pre">zrf8_48dr</span></code></p>
</li>
<li><p>Build the component unit tests from project: <strong>assets</strong> (Takes several hours)</p>
<p>Open a new terminal on your local machine</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <span class="pre">cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/assets/components/&lt;sub-directory&gt;/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">tests</span> <span class="pre">--hdl-platform</span> <span class="pre">zrf8_48dr</span></code></p>
</li>
<li><p>Build the component unit tests from project: <strong>assets_ts</strong> (Takes several hours)</p>
<p>Open a new terminal on your local machine</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <span class="pre">cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/assets_ts/components/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">build</span> <span class="pre">tests</span> <span class="pre">--hdl-platform</span> <span class="pre">zrf8_48dr</span></code></p>
</li>
</ol>
</section>
<section id="run-the-unit-tests-sequentially-on-the-development-host">
<span id="dev-run-the-unit-tests-sequentially-on-the-development-host"></span><h3>Run the Unit Tests (Sequentially) on the Development Host</h3>
<ul class="simple">
<li><p>This section is very painstaking. In order to be certain, that each Component Unit Test is performed, the user must traverse into each unit <code class="docutils literal notranslate"><span class="pre">*\.test</span></code> directory of each component library and to execute the unit test.</p></li>
<li><p>Some of these tests are known to fail or partically fail, per the their performance on a FOSS supported OSP.</p></li>
<li><p>A chart is provided in the** <a class="reference internal" href="#dev-component-unit-test-results-table"><span class="std std-ref">Component Unit Test results table</span></a> <a href="#id4"><span class="problematic" id="id5">**</span></a>section below that outlines the expected outcome for each of these tests (as of v2.4.3).</p></li>
</ul>
<ol class="arabic">
<li><p>Setup for <a class="reference internal" href="#dev-server-mode-setup"><span class="std std-ref">Server Mode setup</span></a></p></li>
<li><p>Run the component unit tests from project: <strong>core</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/core/components/&lt;&gt;.test</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">run</span> <span class="pre">--only-platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--accumulate-errors</span></code></p>
</li>
<li><p>Run the component unit tests from project: <strong>assets</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/assets/components/&lt;sub-directory&gt;/&lt;&gt;.test</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">run</span> <span class="pre">--only-platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--accumulate-errors</span></code></p>
</li>
<li><p>Run the component unit tests from project: <strong>assets_ts</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/assets_ts/components/&lt;&gt;.test</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ocpidev</span> <span class="pre">run</span> <span class="pre">--only-platform</span> <span class="pre">zrf8_48dr</span> <span class="pre">--accumulate-errors</span></code></p>
</li>
</ol>
</section>
</section>
<section id="appendix">
<span id="dev-appendix"></span><h2>APPENDIX</h2>
<section id="petalinux-fix-for-zrf8">
<span id="dev-petalinux-fix-for-zrf8"></span><h3>Petalinux Fix for ZRF8</h3>
<p><strong>GOAL</strong></p>
<ul class="simple">
<li><p>Fix Read-Only SD-Card issues seen when testing default petalinux sd-card artifacts on the ZRF8</p></li>
<li><p>Fix Network issues seen when testting default petalinux sd-card artifacts on the ZRF8.</p></li>
</ul>
<p><strong>IMPLEMENTATION</strong></p>
<p>In order to overcome the Read-Only and Networking issues seen when utilizing the default petalinux sd-card artifacts on the ZRF8 the following items will need to be implmented into the Petalinux project.</p>
<p>These files are located in the <code class="docutils literal notranslate"><span class="pre">ocpi.osp.hitech-global</span></code> <a class="reference external" href="https://gitlab.com/opencpi/osp/ocpi.osp.hitech-global">repository</a></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">/home/user/ocpi.osp.hitech-global/hdl/platforms/zrf8_48dr/guide/petalinux-fix.tar.xz</span></code></p>
</div></blockquote>
<p>Untar these files for use in this section:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">xvf</span> <span class="pre">petalinux-fix.tar.xz</span></code></p>
</div></blockquote>
<p><strong>Read-Only Fix</strong></p>
<blockquote>
<div><p>This issue presents itself once the user mounts the OpenCPI directory onto the <code class="docutils literal notranslate"><span class="pre">/home/root/</span></code> filesystem of the device and attempts to create a file.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">petalinux-fix/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">htg-zrf8.dtsi</span> <span class="pre">system-user.dtsi</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/project-spec/meta-user/recipes-bsp/device-tree/files</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">device-tree.bbappend</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/project-spec/meta-user/recipes-bsp/device-tree/</span></code></p>
</div></blockquote>
<p><strong>Network Fix</strong></p>
<blockquote>
<div><p>This issue presents itself when attempting to to <code class="docutils literal notranslate"><span class="pre">run</span></code> Component Units tests on the device using <code class="docutils literal notranslate"><span class="pre">Server-Mode</span></code>. The device will intermittently lose connection to the host and fail subsequent Component Unit tests.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/project-spec/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">meta-zrf8/recipes-bsp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">petalinux-fix/</span></code></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">conf/</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/project-spec/meta-zrf8/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">pmu-firmware/</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/project-spec/meta-zrf8/recipes-bsp/</span></code></p>
</div></blockquote>
</div></blockquote>
<p><strong>Edit the config file</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/zrf8_48dr_cp/pl_core/build/htg-zrf8-rev3/pl_core/petalinux_cp/project-spec/configs/</span></code></p>
<ol class="arabic">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">config</span></code> file to include the <code class="docutils literal notranslate"><span class="pre">petalinux-image-minimal</span></code> line under the <code class="docutils literal notranslate"><span class="pre">Image</span> <span class="pre">Packaging</span> <span class="pre">Configuration</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_SUBSYSTEM_INITRAMFS_IMAGE_NAME</span><span class="o">=</span><span class="s2">&quot;petalinux-image-minimal&quot;</span>
</pre></div>
</div>
</li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">config</span></code> file to include the <code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">Layers</span></code> lines at the bottom of the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># User Layers</span>
<span class="c1">#</span>
<span class="n">CONFIG_USER_LAYER_0</span><span class="o">=</span><span class="s2">&quot;../project-spec/meta-zrf8&quot;</span>
<span class="n">CONFIG_USER_LAYER_1</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<ul class="simple">
<li><p>Return to <span class="xref std std-ref">dev-Petalinux-workspace-for-Control-Plane</span> section.</p></li>
<li><p>Return to <span class="xref std std-ref">dev-Petalinux-workspace-for-Data-Plane</span> section.</p></li>
</ul>
</section>
<section id="format-sd-card">
<span id="dev-format-sd-card"></span><h3>Format SD card</h3>
<p><strong>GOAL</strong></p>
<ul class="simple">
<li><p>To correctly format the SD-Card for OpenCPI use.</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p>A valid SD-Card with a <code class="docutils literal notranslate"><span class="pre">BOOT</span></code> partition needs to be made.</p>
<ol class="arabic">
<li><p>Be sure to save off any important information on the SD card</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">umount</span> <span class="pre">/dev/sda1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">fdisk</span> <span class="pre">/dev/sda</span></code></p></li>
<li><p>List the current partition table</p>
<p>Command (m for help): <code class="docutils literal notranslate"><span class="pre">p</span></code></p>
</li>
<li><p>Remove all current partitions</p>
<p>Command (m for help): <code class="docutils literal notranslate"><span class="pre">d</span></code></p>
</li>
<li><p>Make the following selections to create two partitions</p>
<ol class="arabic simple">
<li><p>New <code class="docutils literal notranslate"><span class="pre">n</span></code>, Primary <code class="docutils literal notranslate"><span class="pre">p</span></code>, Partition number <code class="docutils literal notranslate"><span class="pre">1</span></code>, First sector <code class="docutils literal notranslate"><span class="pre">[enter]</span></code> (default),
Last sector size <code class="docutils literal notranslate"><span class="pre">[enter]</span></code> (default)</p></li>
</ol>
</li>
<li><p>Write table to disk and exit</p>
<p>Command (m for help): <code class="docutils literal notranslate"><span class="pre">w</span></code></p>
</li>
<li><p>Uninstall and reinstall the SD Card / USB drive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">umount</span> <span class="pre">/dev/sda1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkfs.vfat</span> <span class="pre">-F</span> <span class="pre">32</span> <span class="pre">-n</span> <span class="pre">BOOT</span> <span class="pre">/dev/sda1</span></code></p></li>
<li><p>Uninstall and reinstall the microSD card</p></li>
<li><p>Check that the partition <code class="docutils literal notranslate"><span class="pre">BOOT</span></code> has been created</p></li>
</ol>
</section>
<section id="booting-the-zrf8-48dr">
<span id="dev-booting-the-zrf8-48dr"></span><h3>Booting the zrf8_48dr</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To properly setup the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> device hardware.</p></li>
<li><p>To properly initialize a boot sequence.</p></li>
</ul>
<p><strong>Implementation</strong></p>
<ol class="arabic">
<li><p>Remove power from the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> unit</p></li>
<li><p>With contents provided in either the <span class="xref std std-ref">dev-Populate-the-SD-Card-Artifacts-for-Control-Plane</span> section or the <span class="xref std std-ref">dev-Populate-the-SD-Card-Artifacts-for-Data-Plane</span> section, insert the micro SD-Card into the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> micro SD-Card slot.</p></li>
<li><p>Attach a micro-USB serial port from the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> to the host (Needed for both <code class="docutils literal notranslate"><span class="pre">Standalone-Mode</span></code> and <code class="docutils literal notranslate"><span class="pre">Server-Mode</span></code>)</p></li>
<li><p>Attach an ethernet cable from the <code class="docutils literal notranslate"><span class="pre">zrf8_48dr</span></code> to the host (Only needed for <code class="docutils literal notranslate"><span class="pre">Server-Mode</span></code>)</p></li>
<li><p>Establish a serial connection</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">screen</span> <span class="pre">/dev/ttyUSB0</span> <span class="pre">115200</span></code></p>
</li>
<li><p>Apply Power and monitor the screen serial connection.</p>
<ul class="simple">
<li><p>This will successfully boot the OpenCPI system image artifacts that are located on the microSD card.</p></li>
</ul>
</li>
</ol>
</section>
<section id="standalone-mode-setup">
<span id="dev-standalone-mode-setup"></span><h3>Standalone Mode setup</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>The goal of this section is to enable the user with with ability to setup the Standalone Mode on the ZRF8. Success of this section is the ability to source the <code class="docutils literal notranslate"><span class="pre">mysetup.sh</span></code> script that enables  the Standalone Mode and provides the ability for the Platform Host (ZRF8) to load the local bitstream.</p></li>
</ul>
<p><strong>IMPLEMENTATION</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_LOCAL_DIR=/home/root/opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">opencpi</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">/media/sd-mmcblk0p1/opencpi/</span> <span class="pre">/home/root/opencpi/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/root/opencpi/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">default_mysetup.sh</span> <span class="pre">./mysetup.sh</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/home/root/opencpi/mysetup.sh</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@zynqmp</span><span class="o">-</span><span class="n">generic</span><span class="p">:</span><span class="o">~/</span><span class="n">opencpi</span><span class="c1"># source /home/root/opencpi/mysetup.sh</span>
<span class="n">Attempting</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">time</span> <span class="kn">from</span> <span class="nn">time.nist.gov</span>
<span class="n">rdate</span><span class="p">:</span> <span class="n">bad</span> <span class="n">address</span> <span class="s1">&#39;time.nist.gov&#39;</span>
<span class="o">====</span><span class="n">YOU</span> <span class="n">HAVE</span> <span class="n">NO</span> <span class="n">NETWORK</span> <span class="n">CONNECTION</span> <span class="ow">and</span> <span class="n">NO</span> <span class="n">HARDWARE</span> <span class="n">CLOCK</span><span class="o">====</span>
<span class="n">Set</span> <span class="n">the</span> <span class="n">time</span> <span class="n">using</span> <span class="n">the</span> <span class="s2">&quot;date YYYY.MM.DD-HH:MM[:SS]&quot;</span> <span class="n">command</span><span class="o">.</span>
<span class="n">Running</span> <span class="n">login</span> <span class="n">script</span><span class="o">.</span>
<span class="n">OCPI_CDK_DIR</span> <span class="ow">is</span> <span class="n">now</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span><span class="o">/</span><span class="n">opencpi</span>
<span class="n">OCPI_ROOT_DIR</span> <span class="ow">is</span> <span class="n">now</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span><span class="o">/</span><span class="n">opencpi</span><span class="o">/..</span>
<span class="n">Executing</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">opencpi</span><span class="o">-</span><span class="n">persist</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span>
<span class="n">No</span> <span class="n">reserved</span> <span class="n">DMA</span> <span class="n">memory</span> <span class="n">found</span> <span class="n">on</span> <span class="n">the</span> <span class="n">linux</span> <span class="n">boot</span> <span class="n">command</span> <span class="n">line</span><span class="o">.</span>
<span class="p">[</span>  <span class="mf">326.799030</span><span class="p">]</span> <span class="n">opencpi</span><span class="p">:</span> <span class="n">loading</span> <span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">tree</span> <span class="n">module</span> <span class="n">taints</span> <span class="n">kernel</span><span class="o">.</span>
<span class="p">[</span>  <span class="mf">326.810069</span><span class="p">]</span> <span class="o">------------</span><span class="p">[</span> <span class="n">cut</span> <span class="n">here</span> <span class="p">]</span><span class="o">------------</span>
<span class="p">[</span>  <span class="mf">326.814709</span><span class="p">]</span> <span class="n">opencpi</span> <span class="n">ocpi</span><span class="o">=</span><span class="n">mem</span><span class="p">:</span> <span class="n">rejecting</span> <span class="n">DMA</span> <span class="nb">map</span> <span class="n">of</span> <span class="n">vmalloc</span> <span class="n">memory</span>
<span class="p">[</span>  <span class="mf">326.820874</span><span class="p">]</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">CPU</span><span class="p">:</span> <span class="mi">1</span> <span class="n">PID</span><span class="p">:</span> <span class="mi">549</span> <span class="n">at</span> <span class="n">include</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">dma</span><span class="o">-</span><span class="n">mapping</span><span class="o">.</span><span class="n">h</span><span class="p">:</span><span class="mi">275</span> <span class="n">get_dma_memory</span><span class="o">+</span><span class="mh">0x130</span><span class="o">/</span><span class="mh">0x258</span> <span class="p">[</span><span class="n">opencpi</span><span class="p">]</span>
<span class="p">[</span>  <span class="mf">326.830685</span><span class="p">]</span> <span class="n">Modules</span> <span class="n">linked</span> <span class="ow">in</span><span class="p">:</span> <span class="n">opencpi</span><span class="p">(</span><span class="n">O</span><span class="o">+</span><span class="p">)</span> <span class="n">uio_pdrv_genirq</span>
<span class="p">[</span>  <span class="mf">326.836166</span><span class="p">]</span> <span class="n">CPU</span><span class="p">:</span> <span class="mi">1</span> <span class="n">PID</span><span class="p">:</span> <span class="mi">549</span> <span class="n">Comm</span><span class="p">:</span> <span class="n">insmod</span> <span class="n">Tainted</span><span class="p">:</span> <span class="n">G</span>           <span class="n">O</span>      <span class="mf">5.10.0</span><span class="o">-</span><span class="n">xilinx</span><span class="o">-</span><span class="n">v2021</span><span class="mf">.1</span> <span class="c1">#1</span>
<span class="p">[</span>  <span class="mf">326.844677</span><span class="p">]</span> <span class="n">Hardware</span> <span class="n">name</span><span class="p">:</span> <span class="n">ZynqMP</span> <span class="n">HTG</span><span class="o">-</span><span class="n">ZRF8</span> <span class="n">RevA</span> <span class="p">(</span><span class="n">DT</span><span class="p">)</span>
<span class="p">[</span>  <span class="mf">326.849627</span><span class="p">]</span> <span class="n">pstate</span><span class="p">:</span> <span class="mi">40000005</span> <span class="p">(</span><span class="n">nZcv</span> <span class="n">daif</span> <span class="o">-</span><span class="n">PAN</span> <span class="o">-</span><span class="n">UAO</span> <span class="o">-</span><span class="n">TCO</span> <span class="n">BTYPE</span><span class="o">=--</span><span class="p">)</span>
<span class="p">[</span>  <span class="mf">326.855627</span><span class="p">]</span> <span class="n">pc</span> <span class="p">:</span> <span class="n">get_dma_memory</span><span class="o">+</span><span class="mh">0x130</span><span class="o">/</span><span class="mh">0x258</span> <span class="p">[</span><span class="n">opencpi</span><span class="p">]</span>
<span class="p">[</span>  <span class="mf">326.860670</span><span class="p">]</span> <span class="n">lr</span> <span class="p">:</span> <span class="n">get_dma_memory</span><span class="o">+</span><span class="mh">0x130</span><span class="o">/</span><span class="mh">0x258</span> <span class="p">[</span><span class="n">opencpi</span><span class="p">]</span>
<span class="p">[</span>  <span class="mf">326.865709</span><span class="p">]</span> <span class="n">sp</span> <span class="p">:</span> <span class="n">ffff800011cbba50</span>
<span class="p">[</span>  <span class="mf">326.869007</span><span class="p">]</span> <span class="n">x29</span><span class="p">:</span> <span class="n">ffff800011cbba50</span> <span class="n">x28</span><span class="p">:</span> <span class="mi">0000000000000013</span>
<span class="p">[</span>  <span class="mf">326.874310</span><span class="p">]</span> <span class="n">x27</span><span class="p">:</span> <span class="mi">0000000000000100</span> <span class="n">x26</span><span class="p">:</span> <span class="n">ffff800008daa580</span>
<span class="p">[</span>  <span class="mf">326.879614</span><span class="p">]</span> <span class="n">x25</span><span class="p">:</span> <span class="mi">0000000000000000</span> <span class="n">x24</span><span class="p">:</span> <span class="n">ffff0008009a7080</span>
<span class="p">[</span>  <span class="mf">326.884918</span><span class="p">]</span> <span class="n">x23</span><span class="p">:</span> <span class="n">ffff800008daa000</span> <span class="n">x22</span><span class="p">:</span> <span class="mi">0000000000020000</span>
<span class="p">[</span>  <span class="mf">326.890221</span><span class="p">]</span> <span class="n">x21</span><span class="p">:</span> <span class="n">ffff800011815000</span> <span class="n">x20</span><span class="p">:</span> <span class="n">ffff0008099d5000</span>
<span class="p">[</span>  <span class="mf">326.895525</span><span class="p">]</span> <span class="n">x19</span><span class="p">:</span> <span class="n">ffff800011cbbb08</span> <span class="n">x18</span><span class="p">:</span> <span class="mi">0000000000000030</span>
<span class="p">[</span>  <span class="mf">326.900828</span><span class="p">]</span> <span class="n">x17</span><span class="p">:</span> <span class="mi">0000000000000000</span> <span class="n">x16</span><span class="p">:</span> <span class="mi">0000000000000000</span>
<span class="p">[</span>  <span class="mf">326.906132</span><span class="p">]</span> <span class="n">x15</span><span class="p">:</span> <span class="n">ffff0008009a7498</span> <span class="n">x14</span><span class="p">:</span> <span class="n">ffffffffffffffff</span>
<span class="p">[</span>  <span class="mf">326.911436</span><span class="p">]</span> <span class="n">x13</span><span class="p">:</span> <span class="n">ffff8000113b3de0</span> <span class="n">x12</span><span class="p">:</span> <span class="mi">00000000000003</span><span class="n">cc</span>
<span class="p">[</span>  <span class="mf">326.916739</span><span class="p">]</span> <span class="n">x11</span><span class="p">:</span> <span class="mi">0000000000000144</span> <span class="n">x10</span><span class="p">:</span> <span class="n">ffff8000113dfde0</span>
<span class="p">[</span>  <span class="mf">326.922042</span><span class="p">]</span> <span class="n">x9</span> <span class="p">:</span> <span class="mi">00000000</span><span class="n">fffff800</span> <span class="n">x8</span> <span class="p">:</span> <span class="n">ffff8000113b3de0</span>
<span class="p">[</span>  <span class="mf">326.927346</span><span class="p">]</span> <span class="n">x7</span> <span class="p">:</span> <span class="n">ffff8000113dfde0</span> <span class="n">x6</span> <span class="p">:</span> <span class="mi">0000000000000001</span>
<span class="p">[</span>  <span class="mf">326.932649</span><span class="p">]</span> <span class="n">x5</span> <span class="p">:</span> <span class="mi">0000000000000000</span> <span class="n">x4</span> <span class="p">:</span> <span class="mi">0000000000000000</span>
<span class="p">[</span>  <span class="mf">326.937953</span><span class="p">]</span> <span class="n">x3</span> <span class="p">:</span> <span class="mi">0000000000000000</span> <span class="n">x2</span> <span class="p">:</span> <span class="n">ffff00087f78d768</span>
<span class="p">[</span>  <span class="mf">326.943256</span><span class="p">]</span> <span class="n">x1</span> <span class="p">:</span> <span class="mi">86250</span><span class="n">eb4fe566300</span> <span class="n">x0</span> <span class="p">:</span> <span class="mi">0000000000000000</span>
<span class="p">[</span>  <span class="mf">326.948560</span><span class="p">]</span> <span class="n">Call</span> <span class="n">trace</span><span class="p">:</span>
<span class="p">[</span>  <span class="mf">326.950996</span><span class="p">]</span>  <span class="n">get_dma_memory</span><span class="o">+</span><span class="mh">0x130</span><span class="o">/</span><span class="mh">0x258</span> <span class="p">[</span><span class="n">opencpi</span><span class="p">]</span>
<span class="p">[</span>  <span class="mf">326.955691</span><span class="p">]</span>  <span class="n">opencpi_init</span><span class="o">+</span><span class="mh">0x2dc</span><span class="o">/</span><span class="mh">0x1000</span> <span class="p">[</span><span class="n">opencpi</span><span class="p">]</span>
<span class="p">[</span>  <span class="mf">326.960300</span><span class="p">]</span>  <span class="n">do_one_initcall</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0x1bc</span>
<span class="p">[</span>  <span class="mf">326.964127</span><span class="p">]</span>  <span class="n">do_init_module</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0x240</span>
<span class="p">[</span>  <span class="mf">326.967866</span><span class="p">]</span>  <span class="n">load_module</span><span class="o">+</span><span class="mh">0x1ec8</span><span class="o">/</span><span class="mh">0x2500</span>
<span class="p">[</span>  <span class="mf">326.971599</span><span class="p">]</span>  <span class="n">__do_sys_finit_module</span><span class="o">+</span><span class="mh">0xb8</span><span class="o">/</span><span class="mh">0xfc</span>
<span class="p">[</span>  <span class="mf">326.975852</span><span class="p">]</span>  <span class="n">__arm64_sys_finit_module</span><span class="o">+</span><span class="mh">0x24</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span>  <span class="mf">326.980367</span><span class="p">]</span>  <span class="n">el0_svc_common</span><span class="o">.</span><span class="n">constprop</span><span class="mf">.0</span><span class="o">+</span><span class="mh">0x94</span><span class="o">/</span><span class="mh">0x1c0</span>
<span class="p">[</span>  <span class="mf">326.985149</span><span class="p">]</span>  <span class="n">do_el0_svc</span><span class="o">+</span><span class="mh">0x44</span><span class="o">/</span><span class="mh">0xb0</span>
<span class="p">[</span>  <span class="mf">326.988448</span><span class="p">]</span>  <span class="n">el0_svc</span><span class="o">+</span><span class="mh">0x14</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span>  <span class="mf">326.991485</span><span class="p">]</span>  <span class="n">el0_sync_handler</span><span class="o">+</span><span class="mh">0x1a4</span><span class="o">/</span><span class="mh">0x1b0</span>
<span class="p">[</span>  <span class="mf">326.995477</span><span class="p">]</span>  <span class="n">el0_sync</span><span class="o">+</span><span class="mh">0x174</span><span class="o">/</span><span class="mh">0x180</span>
<span class="p">[</span>  <span class="mf">326.998775</span><span class="p">]</span> <span class="o">---</span><span class="p">[</span> <span class="n">end</span> <span class="n">trace</span> <span class="mi">40</span><span class="n">bb5a20c5310879</span> <span class="p">]</span><span class="o">---</span>
<span class="p">[</span>  <span class="mf">327.003426</span><span class="p">]</span> <span class="n">opencpi</span><span class="p">:</span> <span class="n">dma_map_single</span> <span class="n">failed</span>
<span class="p">[</span>  <span class="mf">327.007518</span><span class="p">]</span> <span class="n">opencpi</span><span class="p">:</span> <span class="n">get_dma_memory</span> <span class="n">failed</span> <span class="ow">in</span> <span class="n">opencpi_init</span><span class="p">,</span> <span class="n">trying</span> <span class="n">fallback</span>
<span class="p">[</span>  <span class="mf">327.014494</span><span class="p">]</span> <span class="n">NET</span><span class="p">:</span> <span class="n">Registered</span> <span class="n">protocol</span> <span class="n">family</span> <span class="mi">12</span>
<span class="n">Driver</span> <span class="n">loaded</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">OpenCPI</span> <span class="n">ready</span> <span class="k">for</span> <span class="n">zynq</span><span class="o">.</span>
<span class="n">Loading</span> <span class="n">bitstream</span>
<span class="n">Bitstream</span> <span class="n">loaded</span> <span class="n">successfully</span>
<span class="n">Discovering</span> <span class="n">available</span> <span class="n">containers</span><span class="o">...</span>
<span class="n">Available</span> <span class="n">containers</span><span class="p">:</span>
 <span class="c1">#  Model Platform            OS     OS-Version  Arch     Name</span>
 <span class="mi">0</span>  <span class="n">hdl</span>   <span class="n">zrf8_48dr</span>                                       <span class="n">PL</span><span class="p">:</span><span class="mi">0</span>
 <span class="mi">1</span>  <span class="n">rcc</span>   <span class="n">xilinx21_1_aarch64</span>  <span class="n">linux</span>  <span class="mi">21_1</span>        <span class="n">aarch64</span>  <span class="n">rcc0</span>
</pre></div>
</div>
<p><strong>The</strong> <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">reserved</span> <span class="pre">DMA</span> <span class="pre">memory</span> <span class="pre">found</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">linux</span> <span class="pre">boot</span> <span class="pre">command</span> <span class="pre">line.</span></code> <strong>warning messages can be ignored as they have not been found to create an issue.</strong></p>
</section>
<section id="server-mode-setup">
<span id="dev-server-mode-setup"></span><h3>Server Mode setup</h3>
<p><strong>GOAL:</strong></p>
<ul class="simple">
<li><p>To enable the user with the ability to setup the Server Mode, which is used extensively for performing Component Unit Testings.</p></li>
<li><p>Success of this section is the ability to utilize the ocpiremote utility that enables the Server Mode and provides the ability to load bitstreams from the Client-side (Host) to the Server-side (embedded device).</p></li>
</ul>
<p><strong>IMPLEMENTATION:</strong></p>
<p><strong>Be sure that the following file matches the code block below.</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">/home/user/opencpi/cdk/zrf8_48dr/system.xml</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>If it does not match the code-block below, you can edit it here and redeploy the platform.</p></li>
<li><p>However, if the hdl-platform is deleted and redeployed, this system.xml will not updated.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">opencpi</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">rcc</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">remote</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">hdl</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">device</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;PL:0&#39;</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;zrf8_48dr&#39;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">hdl</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">container</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">transfer</span> <span class="n">smbsize</span><span class="o">=</span><span class="s1">&#39;128K&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">pio</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span> <span class="n">smbsize</span><span class="o">=</span><span class="s1">&#39;10M&#39;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">dma</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">socket</span> <span class="n">load</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">transfer</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">opencpi</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Device Setup</strong></p>
<ol class="arabic">
<li><p>Establish a screen connection to the device</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">screen</span> <span class="pre">/dev/ttyUSB0</span> <span class="pre">115200</span></code></p>
</li>
<li><p>Setup the IP Address</p>
<p><code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">eth0</span> <span class="pre">down</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">eth0</span> <span class="pre">add</span> <span class="pre">&lt;Valid</span> <span class="pre">ip-address&gt;</span> <span class="pre">netmask</span> <span class="pre">255.255.255.0</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">eth</span> <span class="pre">up</span></code></p>
</li>
</ol>
<p><strong>Host Setup</strong></p>
<ol class="arabic">
<li><p>Source the OpenCPI environment</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">opencpi/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">cdk/opencpi-setup.sh</span> <span class="pre">-s</span></code></p>
</li>
<li><p>Export the Device IP Address and valid Port</p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_SERVER_ADDRESSES=&lt;Valid</span> <span class="pre">ip-address&gt;:&lt;Valid</span> <span class="pre">port&gt;</span></code></p>
</li>
<li><p>Export a valid socket interface</p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_SOCKET_INTERFACE=&lt;Valid</span> <span class="pre">Socket&gt;</span></code></p>
</li>
<li><p>Load the <code class="docutils literal notranslate"><span class="pre">sandbox</span></code> onto the server (device):</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiremote</span> <span class="pre">load</span> <span class="pre">-s</span> <span class="pre">xilinx21_1_aarch64</span> <span class="pre">-w</span> <span class="pre">zrf8_48dr</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ocpiremote load -s xilinx21_1_aarch64 -w zrf8_48dr
Preparing remote sandbox...
Fri Jan 27 10:53:27 UTC 2023
Creating server package...
Sending server package...
Server package sent successfully
Getting status (no server expected to be running):
Executing remote configuration command: status
No ocpiserve appears to be running: no pid file
</pre></div>
</div>
</li>
<li><p>Start the Server-Mode:</p>
<p><code class="docutils literal notranslate"><span class="pre">ocpiremote</span> <span class="pre">start</span> <span class="pre">-b</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ocpiremote start -b
Executing remote configuration command: start -B
The driver module is not loaded. No action was taken.
Reloading kernel driver:
No reserved DMA memory found on the linux boot command line.
Driver loaded successfully.
Loading opencpi bitstream
PATH=/home/root/sandbox/xilinx21_1_aarch64/bin:/home/root/sandbox/xilinx21_1_aarch64/sdk/bin:/usr/bin:/bin
LD_LIBRARY_PATH=xilinx21_1_aarch64/sdk/lib
VALGRIND_LIB=
nohup ocpiserve -v -p 12345 &gt; 20230127-105808.log
Server (ocpiserve) started with pid: 598.  Initial log is:
Discovery options:  discoverable: 0, loopback: 0, onlyloopback: 0
Container server at &lt;ANY&gt;:12345
  Available TCP server addresses are:
    On interface eth0: 10.100.1.20:12345
Artifacts stored/cached in the directory &quot;artifacts&quot;, which will be retained on exit.
Containers offered to clients are:
   0: PL:0, model: hdl, os: , osVersion: , platform: zrf8_48dr
   1: rcc0, model: rcc, os: linux, osVersion: 21_1, platform: xilinx21_1_aarch64
--- end of server startup log success above
</pre></div>
</div>
<ul>
<li><p>If you are presented with the following error while attempting to run any of the Unit-Tests or applications, you may need to disable or reconfigure your firewall:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OCPI</span><span class="p">(</span> <span class="mi">2</span><span class="p">:</span><span class="mf">991.0828</span><span class="p">):</span> <span class="ne">Exception</span> <span class="n">during</span> <span class="n">application</span> <span class="n">shutdown</span><span class="p">:</span> <span class="n">error</span> <span class="n">reading</span> <span class="kn">from</span> <span class="nn">container</span> <span class="n">server</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">EOF</span> <span class="n">on</span> <span class="n">socket</span> <span class="n">read</span>
<span class="n">Exiting</span> <span class="k">for</span> <span class="n">exception</span><span class="p">:</span> <span class="n">error</span> <span class="n">reading</span> <span class="kn">from</span> <span class="nn">container</span> <span class="n">server</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">EOF</span> <span class="n">on</span> <span class="n">socket</span> <span class="n">read</span>
</pre></div>
</div>
<p>How to disable your firewall:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">firewall-cmd</span> <span class="pre">--state</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">firewalld</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">firewall-cmd</span> <span class="pre">--state</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">firewalld</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">mask</span> <span class="pre">--now</span> <span class="pre">firewalld</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">firewalld</span></code></p>
</div></blockquote>
</div></blockquote>
</li>
</ul>
</li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">testbias</span></code> application</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/user/opencpi/projects/assets/applications/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OCPI_LIBRARY_PATH=../imports/ocpi.core/artifacts/:../../assets/artifacts/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ocpirun</span> <span class="pre">-v</span> <span class="pre">-P</span> <span class="pre">bias=zrf8_48dr</span> <span class="pre">-p</span> <span class="pre">bias=biasValue=0</span> <span class="pre">testbias.xml</span></code></p>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ocpirun -v -P bias=zcu102 -p bias=biasValue=0 testbias.xml
Received server information from &quot;10.3.10.66:12345&quot;.  Available containers are:
  10.3.10.66:12345/PL:0                platform zcu102, model hdl, os , version , arch , build
    Transports: ocpi-dma-pio,00:0a:35:00:22:01,0,0,0x41,0x101|ocpi-socket-rdma, ,1,0,0x42,0x41|
  10.3.10.66:12345/rcc0                platform xilinx19_2_aarch64, model rcc, os linux, version 19_2, arch aarch64, build
    Transports: ocpi-dma-pio,00:0a:35:00:22:01,1,0,0x103,0x103|ocpi-smb-pio,00:0a:35:00:22:01,0,0,0xb,0xb|ocpi-socket-rdma, ,1,0,0x42,0x43|
Available containers are:  0: 10.3.10.66:12345/PL:0 [model: hdl os:  platform: zcu102], 1: 10.3.10.66:12345/rcc0 [model: rcc os: linux platform: xilinx19_2_aarch64], 2: rcc0 [model: rcc os: linux platform: centos7]
Actual deployment is:
  Instance  0 file_read (spec ocpi.core.file_read) on rcc container 2: rcc0, using file_read in ../imports/ocpi.core/artifacts//ocpi.core.file_read.rcc.0.centos7.so dated Tue Oct 25 13:35:05 2022
  Instance  1 bias (spec ocpi.core.bias) on hdl container 0: 10.3.10.66:12345/PL:0, using bias_vhdl/a/bias_vhdl in ../../assets/artifacts//ocpi.assets.testbias_zcu102_base.hdl.0.zcu102.bitz dated Tue Oct 25 16:07:24 2022
  Instance  2 file_write (spec ocpi.core.file_write) on rcc container 1: 10.3.10.66:12345/rcc0, using file_write in ../imports/ocpi.core/artifacts//ocpi.core.file_write.rcc.0.xilinx19_2_aarch64.so dated Tue Oct 25 15:25:11 2022
Application XML parsed and deployments (containers and artifacts) chosen [0 s 160 ms]
Application established: containers, workers, connections all created [0 s 102 ms]
Application started/running [0 s 1 ms]
Waiting for application to finish (no time limit)
Application finished [0 s 20 ms]
</pre></div>
</div>
<ol class="arabic">
<li><p>Validate success</p>
<p><code class="docutils literal notranslate"><span class="pre">md5sum</span> <span class="pre">test.input</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">md5sum</span> <span class="pre">test.output</span></code> (<strong>On server at ``/home/root/sandbox/test.output``</strong>)</p>
<p>If they have a matching <code class="docutils literal notranslate"><span class="pre">md5sum</span></code> then the application run successfully.</p>
</li>
</ol>
</section>
<section id="test-results-tables">
<span id="dev-test-results-tables"></span><h3>Test results tables</h3>
<p><strong>P</strong>: <em>PASS</em></p>
<p><strong>F</strong>: <em>FAIL</em></p>
<p><strong>Excluded</strong>: FOSS Makefile limits building of this test and was <em>excluded</em></p>
<p><strong>Failed Cases</strong></p>
<p>data_src - case01.06, case01.07, case01.22, case01.23, case01.30, case01.31, case01.38, case01.39, case01.46, case01.47, case01.54, case01.55, case01.62, case01.63, case01.70, case01.71, case01.78, case01.79</p>
<ul class="simple">
<li><p><strong>These cases ALSO failed when testing on the ZCU102. That’s to say the ZRF8 is as successfull as the ZCU102</strong></p></li>
</ul>
<section id="component-unit-test-results-table">
<span id="dev-component-unit-test-results-table"></span><h4>Component Unit Test results table</h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>FOSS Version</p></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>Platform Under Test</p></th>
<th class="head"><p>zrf8_48dr</p></th>
</tr>
<tr class="row-odd"><th class="head"></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>Component Library Under Test</p></th>
<th class="head"><p>Pass / Fail</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><strong>core/components</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>backpressure</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>bias</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>metadata_stressor</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>assets/components/comms_comps</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>mfsk_mapper</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><strong>assets/components/dsp_comps</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>cic_dec</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>cic_int</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>complex_mixer</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>dc_offset_filter</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>downsample_complex</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>fir_complex_sse</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>fir_real_sse</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>iq_imbalance_fixer</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>phase_to_amp_cordic</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>pr_cordic</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>rp_cordic</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>assets/components/misc_comps</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>cdc_bits_tester</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-even"><td><p>cdc_count_up_tester</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-odd"><td><p>cdc_fifo_tester</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-even"><td><p>cdc_pulse_tester</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-odd"><td><p>cdc_single_bit_tester</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-even"><td><p>csts_to_iqstream</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>cswm_to_iqstream</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-even"><td><p>data_src</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-odd"><td><p>delay</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>iqstream_to_csts</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>iqstream_to_cswm</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>iqstream_to_timeiq</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>timeiq_to_iqstream</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><strong>assets/components/util_comps</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>agc_real</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>fifo</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>pattern_v2</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>capture_v2</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>test_tx_event</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>timestamper</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>timestamper_scdcd</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>timegate_csts</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>timestamper_scdcd_csts</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>zero_pad</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><strong>assets_ts/components</strong></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>cic_dec_ts</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td><p>complex_mixer_ts</p></td>
<td><p>Excluded</p></td>
</tr>
<tr class="row-even"><td><p>dc_offset_filter_ts</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>downsample_complex_ts</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>fir_complex_sse_ts</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="application-verification-results-table">
<span id="dev-application-verification-results-table"></span><h4>Application verification results table</h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>FOSS Version</p></th>
<th class="head"><p>v2.1.0</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Platform Under Test</p></th>
<th class="head"><p>zrf8_48dr</p></th>
</tr>
<tr class="row-odd"><th class="head"></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>Application Under Test</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>pattern_capture_asm</p></td>
<td><p>P</p></td>
</tr>
<tr class="row-even"><td><p>testbias</p></td>
<td><p>P</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="OpenCPI_zrf8_48dr_Getting_Started_Guide.html" class="btn btn-neutral float-left" title="OpenCPI zrf8_48dr Getting Started Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on 31 January 2023.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>